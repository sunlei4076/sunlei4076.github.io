<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JavaScript 标准库（The JavaScript Standard Library） | javascript-the-definitive-guide</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="shortcut icon" type="image/x-icon" href="/javascript-the-definitive-guide/favicon.ico">
    <meta name="description" content="javascript-the-definitive-guide">
    
    <link rel="preload" href="/javascript-the-definitive-guide/assets/css/0.styles.bb7bf066.css" as="style"><link rel="preload" href="/javascript-the-definitive-guide/assets/js/app.4c89be95.js" as="script"><link rel="preload" href="/javascript-the-definitive-guide/assets/js/2.c2bc8f28.js" as="script"><link rel="preload" href="/javascript-the-definitive-guide/assets/js/16.3124fb08.js" as="script"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/10.b94191f9.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/11.38677894.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/12.fcded803.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/13.6e5f6082.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/14.0fc28e1c.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/15.45820836.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/17.dce0f8e0.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/18.65c4cbd2.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/19.8cc98c22.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/20.fc12cd35.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/21.5ce63821.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/22.dc71fcb6.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/3.327a4fa9.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/4.d55aa230.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/5.5c367995.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/6.18dc24fc.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/7.04483a08.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/8.1483022f.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/9.b57d10fe.js">
    <link rel="stylesheet" href="/javascript-the-definitive-guide/assets/css/0.styles.bb7bf066.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/javascript-the-definitive-guide/" class="home-link router-link-active"><!----> <span class="site-name">javascript-the-definitive-guide</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="http://www.atguigu.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  官网
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="http://www.gulixueyuan.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  谷粒学院
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习路线" class="dropdown-title"><span class="title">学习路线</span> <span class="arrow down"></span></button> <button type="button" aria-label="学习路线" class="mobile-dropdown-title"><span class="title">学习路线</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://www.atguigu.com/web/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  前端
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://www.atguigu.com/kecheng.shtml" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Java
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://www.atguigu.com/bigdata/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  大数据
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="http://www.atguigu.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  官网
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="http://www.gulixueyuan.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  谷粒学院
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习路线" class="dropdown-title"><span class="title">学习路线</span> <span class="arrow down"></span></button> <button type="button" aria-label="学习路线" class="mobile-dropdown-title"><span class="title">学习路线</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://www.atguigu.com/web/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  前端
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://www.atguigu.com/kecheng.shtml" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Java
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://www.atguigu.com/bigdata/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  大数据
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>javascript-the-definitive-guide</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/javascript-the-definitive-guide/p01_Type.html" class="sidebar-link">词法结构（Lexical Structure）</a></li><li><a href="/javascript-the-definitive-guide/p02_Expression.html" class="sidebar-link">表达式和操作符（Expressions andOperators）</a></li><li><a href="/javascript-the-definitive-guide/p03_Statement.html" class="sidebar-link">语句 (Statements)</a></li><li><a href="/javascript-the-definitive-guide/p04_Object.html" class="sidebar-link">对象（Object）</a></li><li><a href="/javascript-the-definitive-guide/p05_Array.html" class="sidebar-link">数组（Arrays）</a></li><li><a href="/javascript-the-definitive-guide/p06_Function.html" class="sidebar-link">函数（Functions）</a></li><li><a href="/javascript-the-definitive-guide/p07_Class.html" class="sidebar-link">类（Classes）</a></li><li><a href="/javascript-the-definitive-guide/p08_Module.html" class="sidebar-link">模块（Modules）</a></li><li><a href="/javascript-the-definitive-guide/p09_Set.html" aria-current="page" class="active sidebar-link">JavaScript 标准库（The JavaScript Standard Library）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/javascript-the-definitive-guide/p09_Set.html#javascript-标准库-the-javascript-standard-library" class="sidebar-link">JavaScript 标准库（The JavaScript Standard Library）</a></li></ul></li><li><a href="/javascript-the-definitive-guide/p10_RegExp.html" class="sidebar-link">正则表达式（Pattern Matching with Regular Expressions）</a></li><li><a href="/javascript-the-definitive-guide/p11_StandardLib.html" class="sidebar-link">日期和时间（Dates and Times）</a></li><li><a href="/javascript-the-definitive-guide/p12_Iterator.html" class="sidebar-link">迭代器和生成器（Iterators and generators）</a></li><li><a href="/javascript-the-definitive-guide/p13_Promise.html" class="sidebar-link">异步 JavaScript（Asynchronous JavaScript）</a></li><li><a href="/javascript-the-definitive-guide/p14_Metaprogramming.html" class="sidebar-link">元编程（Metaprogramming）</a></li><li><a href="/javascript-the-definitive-guide/p15_WebBasic.html" class="sidebar-link">浏览器中的 JavaScript（JavaScript in Web Browsers）</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="javascript-标准库-the-javascript-standard-library"><a href="#javascript-标准库-the-javascript-standard-library" class="header-anchor">#</a> JavaScript 标准库（The JavaScript Standard Library）</h2> <p>某些数据类型，例如数字、字符串、对象、数组，它们都是 JavaScript 中的基础，我们可以将它们认为是 JavaScript 语言本身的一部分。在这一章中，许多其他的很重要的，但是并不是 JavaScript 基础的 APIs。它们被定义成了 JavaScript 的标准库（Standard library）：JavaScript 的内嵌的一些类和函数，在浏览器和 Node 中都可用。其中主要包括了：</p> <ul><li><strong>Set 和 Map</strong> 类，用来用来表示值的集合和两个集合之间的映射</li> <li><strong>TypedArrays</strong>，是一种用数组表示二进制数据的类数组对象</li> <li><strong>Regular expression 和 RegExp</strong> 类，用于表示文本的格式</li> <li><strong>Date</strong> 类用于表示日期和时间</li> <li><strong>Error</strong> 类和其多样的子类，JavaScript 抛出的异常就是 Error 类的实例</li> <li><strong>JSON</strong> 对象，用于构建和解析 JavaScript 数据解构</li> <li><strong>Intl</strong> 对象，用其定义的类可以用于本地化 JavaScript 程序</li> <li><strong>Console</strong> 对象，其方法可以返回字符串用于 debug 和 log</li> <li><strong>URL</strong> 类，使解析和修改 url 变得更为简单</li> <li><strong>setTimeout()</strong> 和其他相关的函数，用于控制函数的执行时间</li></ul> <h3 id="set-和-map-sets-and-maps"><a href="#set-和-map-sets-and-maps" class="header-anchor">#</a> Set 和 Map（Sets and Maps）</h3> <p>JavaScript 的对象是一个十分灵活的数据类型，它可以用于将值映射到字符串上（属性名）。如果我们忽略它的值，那么对象就成了字符串的集合了。不过这样的话，仍然会有些许限制。比如对于字符串有限制（某些符号不能使用）；又比如他依然会从对象的原型对象上继承某些不必要的方法。</p> <p>所以在 ES6 中，真正的 Set 和 Map 类被加入了。</p> <h4 id="set-类"><a href="#set-类" class="header-anchor">#</a> Set 类</h4> <p>set 和数组一样是值的集合，不过它和数组不同，set 没有顺序和索引，而且不能有重复的值：对一个值，我们只知道他是否在 set 内，而无法判断它出现了几次。</p> <p>我们可以通过 Set() 构造函数来创建一个 Set 对象：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> s1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 一个新的空 set</span>
<span class="token keyword">let</span> s2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span>s1<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 一个拥有两个元素的 set</span>
</code></pre></div><p>对于构造函数 Set() 的 argument，他并不一定需要一个数组，任何可遍历对象（包括 Set 对象）都可以成为 argument：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> s3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 一个新的，复制了 s1 中每一个元素的 set</span>
<span class="token keyword">let</span> s4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token string">'abbccccdddd'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 四个元素的 set，包括 &quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;</span>
</code></pre></div><p>set 拥有一个 size 属性，等同于数组的 length 属性，返回 set 中的元素数量：</p> <div class="language-js extra-class"><pre class="language-js"><code>s4<span class="token punctuation">.</span>size <span class="token comment">// 4</span>
</code></pre></div><p>在创建 set 时，我们并不一定要同时进行初始化，我们可以新增或者移除其中的元素使用 set 上的方法。不过要记住的是，因为 set 不包含重复元素，所以在加入重复元素时并不会产生效果：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 新建空 set</span>
s<span class="token punctuation">.</span>size<span class="token punctuation">;</span> <span class="token comment">// 0</span>
s<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 加入一个数字作为元素</span>
s<span class="token punctuation">.</span>size <span class="token comment">// 1</span>
s<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 加入一个数组作为元素
s<span class="token punctuation">.</span>size <span class="token comment">// 2</span>
s<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// true，删除成功 </span>
s<span class="token punctuation">.</span>size <span class="token comment">// 1</span>
s<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token comment">// false，没有 4，删除失败</span>
s<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false，set 中数组的引用不同</span>
s<span class="token punctuation">.</span>size <span class="token comment">// 1</span>
s<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 删除所有元素</span>
s<span class="token punctuation">.</span>size <span class="token comment">// 0</span>
</code></pre></div><p>需要注意的是：</p> <ul><li><p>add() 方法只能接受一个 argument，即使传入数组，也只不过是将数组直接加入 set 作为元素。add() 的返回值是调用其的 set，所以可以使用 chained 方法调用：</p> <div class="language-js extra-class"><pre class="language-js"><code>s<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>delete() 方法也只能接受一个 argument，然后删除一个元素，不过返回值是一个布尔值，用来表示是否成功删除</p></li> <li><p>set 的元素是通过全等 === 来判断的，一个 set 可以同时包含 1 和 '1'，因为它们并不全等。对于对象也是通过全等进行比较的，只两个引用着同一个对象的值才可以成为全等</p></li></ul> <p>set 还有一个很重要的方法是使用 has() 来判断其是否包含一个值：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
s<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
s<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
s<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
</code></pre></div><p>因为 set 不存在重复的元素，所以其 has() 方法的运行速度是被优化过的。has() 会比 includes() 快很多。所以使用数组来表示 set 对象会比使用 Set 来慢得多。</p> <p>Set 类也是可遍历的，所以可以使用 for of 来遍历其所有元素，也可以使用展开操作符来将其转换成数组。虽然 set 通常被定义为未经排序的集合，但是 JavaScript 的 Set 类其实记住 Set 元素加入时的顺序，然后 以此作为遍历顺序。除了使用 for of 之外，Set 对象上也有 forEach() 方法用于遍历：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> product <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> element <span class="token keyword">of</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 使用 for of 遍历 set</span>
  sum <span class="token operator">+=</span> element
<span class="token punctuation">}</span>
sum <span class="token comment">// 10</span>
s<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">element</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// 使用 Set 上的 forEach 方法遍历</span>
  product <span class="token operator">*=</span> element<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
product <span class="token comment">// 24</span>
</code></pre></div><h4 id="map-类"><a href="#map-类" class="header-anchor">#</a> Map 类</h4> <p>Map 对象表示了值的集合，这些值被称为 keys。每一个 key 会对应另一个值。简单地说，map 就像是一个数组，只不过使用了 keys 来代替索引。和数组一样，查找一个值的速度很快（但不如数组），而且和 map 大小无关。我们可以使用 Map() 构造函数来创建一个新的 map：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> m1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建一个新的空 map</span>
<span class="token keyword">let</span> m2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span> <span class="token comment">// 使用字符串作为 key，数字作为值的 map</span>
  <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token string">'b'</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Map() 构造函数的可选 argument 需要是一个包含两个元素 [key, value] 的可遍历对象，或者一个其他的 map：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> m3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span>m2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//  复制另一个 map</span>
<span class="token keyword">let</span> o <span class="token operator">=</span> <span class="token punctuation">{</span> x<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span> y<span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 两个属性的对象</span>
<span class="token keyword">let</span> m4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 这样也可以，因为 Object.entries 返回可遍历的 [key, value]</span>
</code></pre></div><p>Map 对象上也有许多好用的方法：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建新的空 map</span>
m<span class="token punctuation">.</span>size <span class="token comment">// 0 没有 key</span>
m<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 加入 key 为 'a'，value 为 1 的 pair</span>
m<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 加入 key 为 'b'，value 为 2 的 pair</span>
m<span class="token punctuation">.</span>size <span class="token comment">// 2 有两个 keys</span>
m<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1，取得 key 'b' 所对应的值</span>
m<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'c'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span>
m<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true，判断是否有 key 'b'</span>
m<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false，只能判断 key，不能判断值</span>
m<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span> <span class="token comment">// true，删除 key 'a' 和其的值</span>
m<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span> <span class="token comment">// false，'a' 已经被删除了</span>
m<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 删除所有元素</span>
</code></pre></div><p>和 set 一样，所有 JavaScript 的值都可以成为 key 或者 value，这也包含了 null、undefined、NaN 和所有引用类型（如对象）。使用 has() 和 get() 时也是通过全等 === 进行比较的。</p> <p>Map 对象也是可遍历的，每一个遍历值会返回 [key, value]。对 Map 对象使用展开操作符会得到类似于我们传入构造函数那样的 array of arrays：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&quot;x&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;y&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token operator">...</span>m<span class="token punctuation">]</span> <span class="token comment">//  [[&quot;x&quot;, 1], [&quot;y&quot;, 2]]</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span> value<span class="token punctuation">]</span> <span class="token keyword">of</span> m<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 使用 for of 遍历 map，顺序也是插入顺序</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>
m<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// 使用 Map 上的 forEach 方法遍历，顺序也是插入顺序</span>
  <span class="token operator">...</span> <span class="token comment">// 注意，value 是第一个参数，而 key 是第二个</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>如果我们只想遍历 map 的 keys 或着 values 可以使用 keys() 或 valuse() 方法，它们会返回只包含 keys 或者 values 的可遍历对象。（还有 entries() 方法用于返回 key value pair）：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&quot;x&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;y&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
m<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// MapIterator {&quot;x&quot;, &quot;y&quot;}</span>
m<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// MapIterator {&quot;1&quot;, &quot;2&quot;}</span>
m<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// MapIterator {&quot;x&quot; =&gt; 1, &quot;y&quot; =&gt; 2}</span>
<span class="token comment">// 可以对可遍历对象使用展开操作符 ... </span>
<span class="token punctuation">[</span><span class="token operator">...</span>m<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token comment">// [&quot;x&quot;, &quot;y&quot;]</span>
<span class="token punctuation">[</span><span class="token operator">...</span>m<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token comment">// [&quot;1&quot;, &quot;2&quot;]</span>
<span class="token punctuation">[</span><span class="token operator">...</span>m<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token comment">// [[&quot;x&quot;, 1], [&quot;y&quot;, 2]]</span>
</code></pre></div><h4 id="weakmap-类和-weakset-类"><a href="#weakmap-类和-weakset-类" class="header-anchor">#</a> WeakMap 类和 WeakSet 类</h4> <p>WeakMap 类是 Map 类的变种（而非子类)。他不会阻止它的键和值被垃圾回收程序（Garbage collection）回收。垃圾回收是一个 JavaScript 编译器重新取回不再可以被使用的内存的过程。普通的 amp 会对器键值持有强引用，所以只要 map 存在，键值就一定存在，不论是否有其他的地方在引用他们。WeakMap，则只拥有‘弱’引用，如果键值不再 reachable，他们的存在便不再重要，会被垃圾回收掉。</p> <p>WeakMap() 构造函数和 Map() 构造函数十分接近，不过:</p> <ul><li>WeakMap 的 keys 必须是对象或者数组；因为基本类型并不在垃圾回收范围之内</li> <li>WeakMap 不可遍历，没有定义 keys()、values()、entries()、forEach()方法。因为如果它可以被遍历，它的 keys 就会被使用</li> <li>同理，WeakMap 也不用有 size 属性，因为 size 属性会在垃圾回收后改变</li></ul> <p>使用 WeakMap 的主要目的就是为了防止内存泄漏（通常会在缓存时使用）。</p> <p>WeakSet 对于 Set 的改变基本等同于 WeakMap 对于 Map 的改变。</p> <h3 id="类型化数组和二进制文件-typed-arrays-and-binary-data"><a href="#类型化数组和二进制文件-typed-arrays-and-binary-data" class="header-anchor">#</a> 类型化数组和二进制文件（Typed Arrays and Binary Data）</h3> <p>一般的 JavaScript 数组可以拥有任何类型的元素，并且长度也是动态的。JavaScript 的实现对它们进行了很多的优化，所以一般情况下都非常快。尽管如此，JavaScript 的数组和更底层语言（如 C 或 Java）中的数组类型还是有很大区别的。</p> <p>类型化数组（Typed arrays） 使在 ES6 引入的新特性。它们更接近于底层语言。Typed arrays 从技术层面上讲其实并不是数组（Array.isArray() 会返回 false），但是它们拥有所有数组所拥有的方法。Typed arrays 和普通数组的区别主要是：</p> <ul><li>typed array 的元素均为数字，并且可以指定数字的类型（signed integer、unsigned integer、IEEE-754 浮点数）和长度（ 8 bits 到 64 bits）。</li> <li>在创建 typed array 时，必须指定其长度；typed array 的长度在定义以后不能再改变</li> <li>在创建 typed array 时，所有的元素都被初始化为 0</li></ul> <h4 id="typed-array-类型"><a href="#typed-array-类型" class="header-anchor">#</a> Typed Array 类型</h4> <p>JavaScript 并没有定义 typed array 类，其原因是这一共有 11 种不同的 typed array，他们拥有不同的元素类型和构造函数：</p> <ul><li><strong>构造函数</strong> --- 数字类型</li> <li><strong>Int8Array()</strong> --- signed bytes</li> <li><strong>Uint8Array()</strong> --- unsigned bytes</li> <li><strong>Uint8ClampedArray()</strong> --- unsigned bytes without rollover</li> <li><strong>Int16Array()</strong> --- signed 16-bit short integers</li> <li><strong>Uint16Array()</strong> --- unsigned 16-bit short integers</li> <li><strong>Int32Array()</strong> --- signed 32-bit integers</li> <li><strong>Uint32Array()</strong> --- unsigned 32-bit integers</li> <li><strong>BigInt64Array()</strong> --- signed 64-bit BigInt values (ES2020 新增)</li> <li><strong>BigUint64Array()</strong> --- unsigned 64-bit BigInt values (ES2020 新增)</li> <li><strong>Float32Array()</strong> --- 32-bit floating-point value</li> <li><strong>Float64Array()</strong> --- 64-bit floating-point value (也就是 JavaScript 中的 Number）</li></ul> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7d56251a0c334cc4b71cff018bed9b27~tplv-k3u1fbpfcp-watermark.image" alt=""></p> <p>由 Int 开始命名的类型是 1，2，4 字节（8，16，32 位）的有符号整数的数组；由 Uint 开始命名的则是同长度的正整数的数组；而 BigInt 类型则是拥有 8字节（64位），表示了 JavaScript 中  BigInt 值的数组；Float64Array 的元素就是 JavaScript 中的数字；Float32Array 中的元素则拥有更低的进度和更短的长度（C 和 Java 中的 float）；Unit8ClampedArray 则是 Uint8Array 的变种，它们都可以用来表示 0 到 255 的值。如果想起存储了大于 255 或者小于 0 的值时，Uint8Array 会进行回绕（wraps around），所以会得到不一样的值；而 Uint8ClampedArray 则会进行类型检验，若大于 255 或小于 0 则会编程 255 或 0（这会在 canvas 的底层 API 操作像素颜色时被用到）。</p> <p>每一个构造函数都拥有 BYTES_PER_ELEMENT 的属性用来表示其字节数。</p> <h4 id="创建-typed-array"><a href="#创建-typed-array" class="header-anchor">#</a> 创建 Typed Array</h4> <p>创建 typed array 最简单的方法就是调用其构造函数，并传入长度作为 argument：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1024 字节</span>
<span class="token keyword">let</span> matrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float64Array</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3x3 矩阵</span>
<span class="token keyword">let</span> point <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Int16Array</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3D 中的一个点</span>
<span class="token keyword">let</span> rgba <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8ClampedArray</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 4 字节的 RGBA 像素值</span>
<span class="token keyword">let</span> sudoku <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Int8Array</span><span class="token punctuation">(</span><span class="token number">81</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 9x9 的数独</span>
</code></pre></div><p>创建完成后，其中的属性都被保证初始化为 0.0 或者 0.0n（BigInt）。如果在构造时就已经知道想要传入的值的话，也可以直接定义值。每一个 typed array 的构造函数都拥有 from() 和 of() 的静态方法，使用起来和数组的一样：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> white <span class="token operator">=</span> Uint8ClampedArray<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// RGBA 中的 opaque white</span>
<span class="token keyword">let</span> white2 <span class="token operator">=</span> Uint32Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>white<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 转换成 32 位整数</span>
</code></pre></div><p>最后，这还有一种创建 typed array 的方法，这需要使用到 ArrayBuffer 类。一个 ArrayBuffer 是一个指向内存的不透明引用。我们可以使用构造函数来创建：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBuffer</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token operator">*</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
buffer<span class="token punctuation">.</span>byteLength <span class="token comment">// 1024*1024，一兆内存</span>
</code></pre></div><p>我们并不能在 ArrayBuffer 类上直接进行字节的读写，不过我们可以在其内存中创建 typed array，然后对内存进行读写。我们只需要在调用 typed array 构造函数时传入 ArrayBuffer 作为第一个argument，array buffer 中 一个字节的 offset 作为第二个 argument，typed array 的长度作为第三个 argument 就可以了。第二个和第三个的 argument 是可选的，如果全部省略，则会用 array buffer 中所有内存创建该 typed array；如果省略第三个，他会从创建从 start index 到 end 中所有剩余内存的 typed array。</p> <h4 id="使用-typed-array"><a href="#使用-typed-array" class="header-anchor">#</a> 使用 Typed Array</h4> <p>在 typed array 创建完成后，我们可以对其进行读写，就如同我们读写数组一样。只不过读写速度和内存使用率会根据你定义的 typed array 而大大缩小。虽然 typed array 并不是数组，不过它们重新实行了几乎所有数组的方法。</p> <p>英文 typed array 的长度是固定的，所以 length 是一个只读的值，然后会改变长度的方法也没有被实现。（例如 push(), pop(), shift(), splice()）</p> <h4 id="typed-array-的属性和方法"><a href="#typed-array-的属性和方法" class="header-anchor">#</a> Typed Array 的属性和方法</h4> <p>除去基础的数组方法之外，typed array 还实现了一些它们私有的方法。set() 方法可以设置多个 typed array 的元素：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 一个 1k 的 buffer</span>
<span class="token keyword">let</span> pattern <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 一个四字节的数组</span>
bytes<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>pattern<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将 bytes 的开始的字节改成 pattern 中的字节</span>
bytes<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将 bytes 的从 offset（第二个 argument）开始的字节改成 pattern 中的字节</span>
bytes<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 返回新的 typed array [1,2,3,4,1,2,3,4,0,0]</span>
</code></pre></div><p>typed array 还实现了一个 subarray() 的方法，它的 arguments 和 slice() 的一样，用法也十分酷似。不过它们是有区别的。 slice() 会返回一个新的，独立的 typed array。这意味着它不会和其原来的 typed array 公用同一段内存。而 subarray() 则不同，它不会在内存中创建新的 typed array，而是直接返回其原数组中的那一段的引用：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Int16Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 五个 short integer</span>
<span class="token keyword">let</span> aSub <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">subarray</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [2,3,4]</span>
<span class="token keyword">let</span> aSlice <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [2,3,4]</span>

a<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">33</span><span class="token punctuation">;</span> <span class="token comment">// a = [1,2,33,4,5]</span>
aSub<span class="token punctuation">;</span> <span class="token comment">// [2,33,4] subarray 会根据原数组的值而改动</span>
aSlice <span class="token comment">// [2,3,4] slice 则不会</span>
</code></pre></div><p>每一个 typed array 都拥有三个关于其存在的 buffer 的属性：</p> <div class="language-js extra-class"><pre class="language-js"><code>aSub<span class="token punctuation">.</span>buffer <span class="token comment">// ArrayBuffer 对象用于储存 typed array</span>
aSub<span class="token punctuation">.</span>buffer <span class="token operator">===</span> a<span class="token punctuation">.</span>buffer <span class="token comment">// 指向同一个 buffer</span>
aSub<span class="token punctuation">.</span>byteOffset <span class="token comment">// 2，subarray 的开始位置</span>
aSub<span class="token punctuation">.</span>byteLength <span class="token comment">// 6，subarray 的字节数（三个 16 位整数，每一个使用 2 字节）</span>
aSub<span class="token punctuation">.</span>buffer<span class="token punctuation">.</span>byteLength <span class="token comment">// 10 底层的 buffer 有 10 字节</span>
a<span class="token punctuation">.</span>length <span class="token operator">*</span> a<span class="token punctuation">.</span><span class="token constant">BYTES_PER_ELEMENT</span> <span class="token operator">===</span> a<span class="token punctuation">.</span>byteLength <span class="token comment">// true，根据长度和元素字节数计算字节长度</span>
</code></pre></div><h4 id="字节序和-dataview-类"><a href="#字节序和-dataview-类" class="header-anchor">#</a> 字节序和 DataView 类</h4> <p>出于性能考虑，typed array 会使用其底层硬件的原生字节序（endianness）。而字节序有两种：</p> <ul><li>little-endian，typed array 的字节会从低位到高位进行排序</li> <li>big-endian，typed array 的字节会从高位到低位进行排序</li></ul> <p>目前大多是 CPU 是使用 little-endian 的，但是许多网络协议或者二进制文件则需要 big-endian 排序。在使用从网络上下载的 typed array 表示的文件时，你并不知道其字节序，这时候我们就需要用到 DataView 类了。它可以让我们指定读写的顺序：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 假设我们有一个名为 bytes 的 typed array</span>
<span class="token keyword">let</span> view <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataView</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span>buffer<span class="token punctuation">,</span> bytes<span class="token punctuation">.</span>byteOffset<span class="token punctuation">,</span> bytes<span class="token punctuation">.</span>byteLength<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> int1 <span class="token operator">=</span> view<span class="token punctuation">.</span><span class="token function">getInt32</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 根据 big-endian 从第 0 个字节读取第一个整数</span>
<span class="token keyword">let</span> int2 <span class="token operator">=</span> view<span class="token punctuation">.</span><span class="token function">getInt32</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 根据 big-endian 从第 4 个字节读取第二个整数</span>
<span class="token keyword">let</span> int3 <span class="token operator">=</span> view<span class="token punctuation">.</span><span class="token function">getInt32</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 根据 little-endian 从第 8 个字节读取第三个整数</span>
view<span class="token punctuation">.</span><span class="token function">setInt32</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span>int<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 以 big-endian 写入 </span>
</code></pre></div><p>DataView 对 10 种 typed array 各定义了一个 get 方法，名为 getInt16(), getUint32(), getBigInt64() 等等。第一个 argument 是其 byte offset；除去 getInt8() 和 getUint8() 之外，所有方法还有第二个可选的布尔值 argument，若为 true，用 little-endian 顺序，若为 false，用 big-endian 顺序。</p> <p>DataView 对 10 种 typed array 也各定义了一个 set 方法。第一个 argument 是写入的开始的 offset；第二个 argument 是写入的值；除去 getInt8() 和 getUint8() 之外，所有方法还有第三个可选的布尔值 argument，若为 true，用 little-endian 顺序，若为 false，用 big-endian 顺序。</p> <p>typed arrays 和 DataView 类给了我们在解压 ZIP 文件，或从 JPEG 文件提取元数据的所有必须的工具。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/javascript-the-definitive-guide/p08_Module.html" class="prev">
        模块（Modules）
      </a></span> <span class="next"><a href="/javascript-the-definitive-guide/p10_RegExp.html">
        正则表达式（Pattern Matching with Regular Expressions）
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/javascript-the-definitive-guide/assets/js/app.4c89be95.js" defer></script><script src="/javascript-the-definitive-guide/assets/js/2.c2bc8f28.js" defer></script><script src="/javascript-the-definitive-guide/assets/js/16.3124fb08.js" defer></script>
  </body>
</html>
