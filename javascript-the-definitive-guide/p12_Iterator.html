<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>迭代器和生成器（Iterators and generators） | javascript-the-definitive-guide</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="shortcut icon" type="image/x-icon" href="/javascript-the-definitive-guide/favicon.ico">
    <meta name="description" content="javascript-the-definitive-guide">
    
    <link rel="preload" href="/javascript-the-definitive-guide/assets/css/0.styles.bb7bf066.css" as="style"><link rel="preload" href="/javascript-the-definitive-guide/assets/js/app.4c89be95.js" as="script"><link rel="preload" href="/javascript-the-definitive-guide/assets/js/2.c2bc8f28.js" as="script"><link rel="preload" href="/javascript-the-definitive-guide/assets/js/19.8cc98c22.js" as="script"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/10.b94191f9.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/11.38677894.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/12.fcded803.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/13.6e5f6082.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/14.0fc28e1c.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/15.45820836.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/16.3124fb08.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/17.dce0f8e0.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/18.65c4cbd2.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/20.fc12cd35.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/21.5ce63821.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/22.dc71fcb6.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/3.327a4fa9.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/4.d55aa230.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/5.5c367995.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/6.18dc24fc.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/7.04483a08.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/8.1483022f.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/9.b57d10fe.js">
    <link rel="stylesheet" href="/javascript-the-definitive-guide/assets/css/0.styles.bb7bf066.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/javascript-the-definitive-guide/" class="home-link router-link-active"><!----> <span class="site-name">javascript-the-definitive-guide</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="http://www.atguigu.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  官网
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="http://www.gulixueyuan.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  谷粒学院
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习路线" class="dropdown-title"><span class="title">学习路线</span> <span class="arrow down"></span></button> <button type="button" aria-label="学习路线" class="mobile-dropdown-title"><span class="title">学习路线</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://www.atguigu.com/web/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  前端
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://www.atguigu.com/kecheng.shtml" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Java
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://www.atguigu.com/bigdata/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  大数据
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="http://www.atguigu.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  官网
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="http://www.gulixueyuan.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  谷粒学院
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习路线" class="dropdown-title"><span class="title">学习路线</span> <span class="arrow down"></span></button> <button type="button" aria-label="学习路线" class="mobile-dropdown-title"><span class="title">学习路线</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://www.atguigu.com/web/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  前端
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://www.atguigu.com/kecheng.shtml" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Java
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://www.atguigu.com/bigdata/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  大数据
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>javascript-the-definitive-guide</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/javascript-the-definitive-guide/p01_Type.html" class="sidebar-link">词法结构（Lexical Structure）</a></li><li><a href="/javascript-the-definitive-guide/p02_Expression.html" class="sidebar-link">表达式和操作符（Expressions andOperators）</a></li><li><a href="/javascript-the-definitive-guide/p03_Statement.html" class="sidebar-link">语句 (Statements)</a></li><li><a href="/javascript-the-definitive-guide/p04_Object.html" class="sidebar-link">对象（Object）</a></li><li><a href="/javascript-the-definitive-guide/p05_Array.html" class="sidebar-link">数组（Arrays）</a></li><li><a href="/javascript-the-definitive-guide/p06_Function.html" class="sidebar-link">函数（Functions）</a></li><li><a href="/javascript-the-definitive-guide/p07_Class.html" class="sidebar-link">类（Classes）</a></li><li><a href="/javascript-the-definitive-guide/p08_Module.html" class="sidebar-link">模块（Modules）</a></li><li><a href="/javascript-the-definitive-guide/p09_Set.html" class="sidebar-link">JavaScript 标准库（The JavaScript Standard Library）</a></li><li><a href="/javascript-the-definitive-guide/p10_RegExp.html" class="sidebar-link">正则表达式（Pattern Matching with Regular Expressions）</a></li><li><a href="/javascript-the-definitive-guide/p11_StandardLib.html" class="sidebar-link">日期和时间（Dates and Times）</a></li><li><a href="/javascript-the-definitive-guide/p12_Iterator.html" aria-current="page" class="active sidebar-link">迭代器和生成器（Iterators and generators）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/javascript-the-definitive-guide/p12_Iterator.html#迭代器和生成器-iterators-and-generators" class="sidebar-link">迭代器和生成器（Iterators and generators）</a></li></ul></li><li><a href="/javascript-the-definitive-guide/p13_Promise.html" class="sidebar-link">异步 JavaScript（Asynchronous JavaScript）</a></li><li><a href="/javascript-the-definitive-guide/p14_Metaprogramming.html" class="sidebar-link">元编程（Metaprogramming）</a></li><li><a href="/javascript-the-definitive-guide/p15_WebBasic.html" class="sidebar-link">浏览器中的 JavaScript（JavaScript in Web Browsers）</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="迭代器和生成器-iterators-and-generators"><a href="#迭代器和生成器-iterators-and-generators" class="header-anchor">#</a> 迭代器和生成器（Iterators and generators）</h2> <p>可迭代对象（Iterable objects）和其迭代器（iterators）是在 ES6 中新增的特性。例如数组，类型化数组，字符串，Set 和 Map 都是可迭代对象。这意味着我们可以使用 for of 循环来对它们进行迭代：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> sum1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token keyword">of</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 对数组元素的值进行迭代</span>
  sum1 <span class="token operator">+=</span> i<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
sum1 <span class="token comment">// 6</span>

<span class="token keyword">let</span> sum2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> s <span class="token keyword">of</span> <span class="token string">'123'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 对字符串的字符进行迭代</span>
  sum2 <span class="token operator">+=</span> <span class="token operator">+</span>s<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
sum2 <span class="token comment">// 6 </span>
</code></pre></div><p>迭代器也使得我们可以对可迭代对象进行展开操作和解构赋值：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> chars <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token string">&quot;abcd&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// chars == [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;]</span>
<span class="token keyword">let</span> <span class="token punctuation">[</span>w<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">]</span> <span class="token operator">=</span> chars<span class="token punctuation">;</span> <span class="token comment">// z = &quot;d&quot;</span>
</code></pre></div><p>Map 会以 [key, value] 形式进行迭代，或者可以通过 keys() 和 values() 方法进行 key 或者 value 的迭代；Set() 构造函数可以接收一个可迭代对象作为 argument：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&quot;one&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;two&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token operator">...</span>m<span class="token punctuation">]</span> <span class="token comment">// [[&quot;one&quot;, 1], [&quot;two&quot;, 2]]</span>
<span class="token punctuation">[</span><span class="token operator">...</span>m<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token comment">// [[&quot;one&quot;, 1], [&quot;two&quot;, 2]]</span>
<span class="token punctuation">[</span><span class="token operator">...</span>m<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token comment">// [&quot;one&quot;, &quot;two&quot;]</span>
<span class="token punctuation">[</span><span class="token operator">...</span>m<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token comment">// [1, 2]</span>

<span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 等同于 new Set([&quot;a&quot;, &quot;b&quot;, &quot;c&quot;])</span>
</code></pre></div><h3 id="迭代器是怎么工作的-how-iterators-work"><a href="#迭代器是怎么工作的-how-iterators-work" class="header-anchor">#</a> 迭代器是怎么工作的（How Iterators Work）</h3> <p>套了解迭代器的工作原理，我们要从下面三个方面展开：</p> <ul><li>可迭代对象(iterable object）</li> <li>迭代器（itertor）对象本身，他会被用于进行迭代</li> <li>迭代结果对象（iteration result object），它会用于存放每一次迭代的结果</li></ul> <ol><li><p>可迭代对象就是任何拥有迭代方法（Symbol Symbol.iterator 为方法名）的对象，该方法可返回迭代器对象。</p></li> <li><p>迭代器对象是任何拥有 next() 方法的对象，该方法会返回一个迭代结果对象。</p></li> <li><p>迭代结果对象是一个拥有属性 value 和 done 的对象。</p></li></ol> <p>若想要迭代一个可迭代对象，我们需要先调用其迭代方法去获得一个迭代器对象，然后调用该迭代器对象的 next() 方法来迭代对象，直到返回值的 done 属性变成了 true。所以我们可以如下实现 for of 循环：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 创建一个数组（可迭代对象）</span>
<span class="token keyword">let</span> iteratorOfa <span class="token operator">=</span> a<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 储存数组的迭代方法</span>
<span class="token comment">// 将 result 赋值为 next() 的返回值，即迭代结果对象。在迭代结果对象的 done 属性不为 false 时，进行迭代</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> result <span class="token operator">=</span> iteratorOfa<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">!</span>result<span class="token punctuation">.</span>done<span class="token punctuation">;</span> result <span class="token operator">=</span> iteratorOfa<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 打印迭代结果对象的 value 属性，即数组元素值</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="实现一个可迭代对象-implementing-iterable-objects"><a href="#实现一个可迭代对象-implementing-iterable-objects" class="header-anchor">#</a> 实现一个可迭代对象（Implementing Iterable Objects）</h3> <p>想要让一个对象可以被迭代的话，我们需要为其实现一个迭代方法。该方法名是一个叫做 Symbol.iterator 的 Symbol；这个方法又必须返回一个可拥有 next() 方法的迭代对象；next() 方法又必须返回一个拥有 value 和 done 属性的迭代结果对象：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Range</span> <span class="token punctuation">{</span> <span class="token comment">// 创建一个新的类</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">lower<span class="token punctuation">,</span> upper</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 定义其构造函数</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>lower <span class="token operator">=</span> lower<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>upper <span class="token operator">=</span> upper<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 定义其迭代方法</span>
    <span class="token keyword">let</span> next <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lower<span class="token punctuation">;</span> <span class="token comment">// 下一个返回值</span>
    <span class="token keyword">let</span> last <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>upper<span class="token punctuation">;</span> <span class="token comment">// 最后的返回值</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token comment">// 返回可迭代对象</span>
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 可迭代对象的 next() 方法，其返回值是迭代结果对象</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> next <span class="token operator">&lt;=</span> last<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 在迭代未结束时返回拥有 value 属性的迭代结果对象</span>
          <span class="token keyword">return</span> <span class="token punctuation">{</span> value <span class="token operator">:</span> next<span class="token operator">++</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// 否则返回拥有 done 为 true 的迭代结果对象</span>
          <span class="token keyword">return</span> <span class="token punctuation">{</span> done <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// 可以将迭代器本身设置为可迭代对象</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token punctuation">[</span><span class="token operator">...</span><span class="token keyword">new</span> <span class="token class-name">Range</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [-3, -2, -1, 0, 1, 2, 3, 4, 5]</span>
</code></pre></div><p>除去定义类时让其可被迭代，我们也可以让函数返回可迭代的值，就比如我们可以用这种方法来实现数组的 map() 或者 filter() 方法：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">iterable<span class="token punctuation">,</span> f</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 实现 map 方法，传入可迭代对象和其 map 时调用的函数</span>
  <span class="token keyword">let</span> iterator <span class="token operator">=</span> iterable<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 取得可迭代对象的迭代器</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token comment">//返回一个对象，它既是可迭代对象，也是迭代器</span>
    <span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> v <span class="token operator">=</span> iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span> v<span class="token punctuation">.</span>done <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> v<span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span> value<span class="token operator">:</span> <span class="token function">f</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">[</span><span class="token operator">...</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token parameter">a</span> <span class="token operator">=&gt;</span> <span class="token number">2</span><span class="token operator">*</span>a <span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token comment">// [2, 4, 6, 8]</span>
</code></pre></div><h4 id="终止迭代器-closing-an-iterator-the-return-method"><a href="#终止迭代器-closing-an-iterator-the-return-method" class="header-anchor">#</a> 终止迭代器（“Closing” an Iterator: The Return Method）</h4> <p>在某些时候，迭代器一路迭代到底，而是在中间就停止，比如 for of 循环中的 break 或者 return 或者一个异常；或者解构赋值时不需要所有可迭代对象中的元素。</p> <p>在迭代器对象上我们也可以实现一个 return() 方法，如果迭代器在 next() 还没有返回到 done 为 true 的迭代结果对象时就停止了的话，编译器便会开始查找是否有 return() 方法，若有，则会不传参数然后调用它。</p> <h3 id="生成器-generators"><a href="#生成器-generators" class="header-anchor">#</a> 生成器（Generators）</h3> <p>虽然迭代器使我们可以使用 for of 循环和展开操作符之类便捷的新特性。但是对于实现新的可迭代对象、其迭代器、以及其迭代结果对象则会十分复杂。这就要介绍到生成器了（generators），它使我们可以更便捷的实现新的可迭代对象。</p> <p>生成器其实也是一种迭代器，不过拥有了 ES6 新增的句法，使其变得更为灵活和便捷。</p> <p>如果想要定义一个生成器，我们需要先定义一个生成器函数。生成器函数的句法和普通函数无异，只不过是通过 function* 而非 function 关键字而定义。当我们调用生成器函数时，他并不会执行函数体，而是返回一个生成器对象，而这个生成器对象也是一个迭代器。在调用该迭代器的 next() 方法时，会继续执行生成器函数体中的语句，直到遇到下一个 yield 关键字。yield 是一个 ES6 新增的关键字，它类似于 return，所以 yield 之后的值便会成为调用 next() 的返回值：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">genF</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 定义一个生成器函数，但调用该函数不会直接运行其函数体，而是创建新的生成器对象</span>
  <span class="token keyword">yield</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 生成器对象的 next() 方法会执行函数体，直到遇见 yield 关键字然后停下</span>
  <span class="token keyword">yield</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 然后该 yield 之后的值便会作为返回值返回</span>
  <span class="token keyword">yield</span> <span class="token number">3</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token number">4</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token number">5</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> gen <span class="token operator">=</span> <span class="token function">genF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 在调用该函数时，获得一个生成器</span>
gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// 1，生成器也是一个可迭代对象，并且可以迭代 yield 的值</span>
gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// 2</span>
gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>done<span class="token punctuation">;</span> <span class="token comment">// false</span>
gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// 4</span>
gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// 5</span>
gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>done<span class="token punctuation">;</span> <span class="token comment">// true</span>

gen<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 该生成器也有迭代方法，所以也可以使用 for of 或解构赋值等</span>
</code></pre></div><p>在对象或者类中，我们也可以使用函数简写来实现生成器：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> o <span class="token operator">=</span> <span class="token punctuation">{</span>
  x<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> y<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> z<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token operator">*</span><span class="token function">g</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">of</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">yield</span> key<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token operator">...</span>o<span class="token punctuation">.</span><span class="token function">g</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token comment">// [&quot;x&quot;, &quot;y&quot;, &quot;z&quot;, &quot;g&quot;]</span>
</code></pre></div><p>不过需要注意的是，箭头函数不能用来创建生成器函数。</p> <p>使用生成器函数可以使我们在定义一个可迭代类时变得更为简单，我们不需要一层一层编写迭代方法、迭代器、迭代结果对象等等，我们只需要编写 *[Symbol.iterator]() 方法即可：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">*</span><span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 使用生成器函数编写迭代方法</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lower<span class="token punctuation">;</span> x <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>upper<span class="token punctuation">;</span> x<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">yield</span> x<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 等同于前面的例子：</span>
<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 定义其迭代方法</span>
  <span class="token keyword">let</span> next <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lower<span class="token punctuation">;</span> <span class="token comment">// 下一个返回值</span>
  <span class="token keyword">let</span> last <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>upper<span class="token punctuation">;</span> <span class="token comment">// 最后的返回值</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token comment">// 返回可迭代对象</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 可迭代对象的 next() 方法，其返回值是迭代结果对象</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span> next <span class="token operator">&lt;=</span> last<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 在迭代未结束时返回拥有 value 属性的迭代结果对象</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span> value <span class="token operator">:</span> next<span class="token operator">++</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// 否则返回拥有 done 为 true 的迭代结果对象</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span> done <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// 可以将迭代器本身设置为可迭代对象</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>可见使用生成器会变得便捷得多。</p> <p><strong>yield</strong>*</p> <p>使用 yield* 使我们可以更为方便的迭代多个可迭代对象的元素：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">genF</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>iterables</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 不使用 yield*</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> iterable <span class="token keyword">of</span> iterables<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> element <span class="token keyword">of</span> iterable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">yield</span> element<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token punctuation">[</span><span class="token operator">...</span><span class="token function">genF</span><span class="token punctuation">(</span><span class="token string">'abcd'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;, 1, 2, 3]</span>

<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">genF</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>iterables</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 不使用 yield*</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> iterable <span class="token keyword">of</span> iterables<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">yield</span><span class="token operator">*</span> iterable<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token punctuation">[</span><span class="token operator">...</span><span class="token function">genF</span><span class="token punctuation">(</span><span class="token string">'abcd'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;, 1, 2, 3]</span>

<span class="token comment">// 两个方法效果一样</span>
</code></pre></div><h3 id="进阶生成器特性-advanced-generator-features"><a href="#进阶生成器特性-advanced-generator-features" class="header-anchor">#</a> 进阶生成器特性（Advanced Generator Features）</h3> <p>虽然生成器最常被用于创建迭代器，但其实它还有一个很重要的特性便是可以暂停和重新开始运行，并在其中产出中间值。</p> <h4 id="生成器函数的返回值"><a href="#生成器函数的返回值" class="header-anchor">#</a> 生成器函数的返回值</h4> <p>在生成器函数中，我们并没有提到它的返回值，即其 return 关键字。return 可以在生成器函数中被使用，但是它并不会直接返回值，而是终止生成器的执行。这个返回值虽然不会直接返回，但是可以在等下被用到：</p> <p>回想一下，迭代器的 next() 方法的返回值是一个拥有 value 和 done 属性的迭代结果对象，对于正常的迭代器和生成器来说，如果 value 被定义，则 done 因为 false 或 undefined；若 done 为 true，则 value 因为 undefined。</p> <p>但如果生成器返回了一个值，则最后一次调用 next() 返回的迭代结果对象的 value 和 done 都会被定义：value 会包含该返回值，而 done 为 true。他虽然会被 for of 循环或者解构赋值等忽略，但是我们可以显示的去调用其 next() 方法来取得该值：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">genF</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
  <span class="token keyword">yield</span> <span class="token number">1</span><span class="token punctuation">;</span> 
  <span class="token keyword">yield</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">3</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token number">4</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">[</span><span class="token operator">...</span><span class="token function">genF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token comment">// [1, 2]，return 3 终止迭代，并且返回值也会被忽略，之后的 4 也会被忽略</span>

<span class="token keyword">let</span> gen <span class="token operator">=</span> <span class="token function">genF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {value: 1, done: false}</span>
gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {value: 2, done: false}</span>
gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {value: 3, done: true} // 可以显示的调用 next() 取得返回值</span>
gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {value: undefined, done: true}，迭代终止，无法取得 4</span>
</code></pre></div><h4 id="yield-表达式的值"><a href="#yield-表达式的值" class="header-anchor">#</a> yield 表达式的值</h4> <p>在前面，我们将 yield 用作为一个产出值的语句，但其实它是一个表达式，也可以拥有自己的值。</p> <p>在生成器的 next() 方法被调用时，它会一路运行到 yield 表达式，其之后紧跟的表达其会被运算然后作为 next() 的返回值。然后生成器函数会停止执行，直到下一次 next() 的调用。然后该 next() 的 argument 就会成为 yield 的值。</p> <p>所以对应关系是：</p> <ul><li>生成器会将 yield 之后的值返回给其调用者</li> <li>调用者又可以在 next() 方法中传入 argument 作为 yield 的值</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">genF</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> y1 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> y2 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> y3 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token number">3</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>y1<span class="token operator">+</span>y2<span class="token operator">+</span>y3<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">4</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> g <span class="token operator">=</span> <span class="token function">genF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
g<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 第一次调用 next 时，结果对象的 value 为 1</span>
g<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 第二次调用 next 时，结果对象的 value 为 2，同时为 y2 进行了 y1 = 4 的赋值</span>
g<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 第三次调用 next 时，结果对象的 value 为 3，同时为 y2 进行了 y2 = 5 的赋值</span>
g<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 第四次调用 next 时，结果对象的 value 为 4，同时为 y2 进行了 y3 = 6 的赋值，并且返回 15</span>
</code></pre></div><h4 id="return-和-throw-方法"><a href="#return-和-throw-方法" class="header-anchor">#</a> return() 和 throw() 方法</h4> <p>在生成器上，它除了拥有 next() 方法，也拥有了 return() 和 throw() 方法。如它们的名字一样，调用它们会返回值或者抛出异常，就如同在生成器中加入了 return 或者 throw 关键字一样：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">genF</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
  <span class="token keyword">yield</span> <span class="token number">1</span><span class="token punctuation">;</span> 
  <span class="token keyword">yield</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> g <span class="token operator">=</span> <span class="token function">genF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
g<span class="token punctuation">.</span><span class="token function">return</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 提前结束迭代，返回 {value: undefined, done: true}</span>
g<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 迭代已经结束，返回 {value: undefined, done: true}</span>
<span class="token keyword">let</span> g2 <span class="token operator">=</span> <span class="token function">genF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
g2<span class="token punctuation">.</span><span class="token function">throw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 提前结束迭代，抛出 Uncaught undefined</span>
</code></pre></div><p>throw() 方法会在生成器内部抛出一个异常，但如果生成器函数内部拥有异常捕获机制，则异常就不一定会是致命的，这意味着生成器可以接着执行:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 计数生成器函数，在遇到异常时重置计数器</span>
  <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">yield</span> i<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">{</span>
      i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> counter <span class="token operator">=</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
counter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
counter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {value: 2, done: false}</span>
counter<span class="token punctuation">.</span><span class="token function">throw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {value: 0, done: false}，重置计时器，不会抛出异常，因为被生成器处理了</span>
counter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {value: 1, done: false}</span>
</code></pre></div><h3 id="小结"><a href="#小结" class="header-anchor">#</a> 小结</h3> <p>这一章的要点：</p> <ul><li>for of 循环和 ... 展开操作符可以对可迭代对象使用</li> <li>具有 Symbol 方法 [Symbol.iterator] 的对象，且该方法会返回一个迭代器，为可迭代对象</li> <li>迭代器对象拥有 next() 方法用于返回迭代结果对象</li> <li>迭代结果对象有一个 value 属性保存迭代值，和一个 done 属性来确定迭代是否完成</li> <li>生成器函数（function*）可以使我们更便捷的定义迭代器</li> <li>在调用生成器函数时，函数体不会直接执行，而是返回一个可迭代的迭代器对象</li> <li>每次调用生成器的生成的迭代器的 next() 时，会执行函数体直到遇见 yield 并将其返回</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/javascript-the-definitive-guide/p11_StandardLib.html" class="prev">
        日期和时间（Dates and Times）
      </a></span> <span class="next"><a href="/javascript-the-definitive-guide/p13_Promise.html">
        异步 JavaScript（Asynchronous JavaScript）
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/javascript-the-definitive-guide/assets/js/app.4c89be95.js" defer></script><script src="/javascript-the-definitive-guide/assets/js/2.c2bc8f28.js" defer></script><script src="/javascript-the-definitive-guide/assets/js/19.8cc98c22.js" defer></script>
  </body>
</html>
