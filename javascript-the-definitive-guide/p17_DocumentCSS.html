<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Scripting Documents | javascript-the-definitive-guide</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="shortcut icon" type="image/x-icon" href="/javascript-the-definitive-guide/favicon.ico">
    <meta name="description" content="javascript-the-definitive-guide">
    
    <link rel="preload" href="/javascript-the-definitive-guide/assets/css/0.styles.0a1f62b9.css" as="style"><link rel="preload" href="/javascript-the-definitive-guide/assets/js/app.b70006d3.js" as="script"><link rel="preload" href="/javascript-the-definitive-guide/assets/js/2.c2bc8f28.js" as="script"><link rel="preload" href="/javascript-the-definitive-guide/assets/js/24.e6e4f156.js" as="script"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/10.e6c9c58c.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/11.6b301624.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/12.c1883762.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/13.6169cf39.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/14.12198edb.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/15.843597b5.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/16.bfb6010c.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/17.4ea79e21.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/18.2fa4f553.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/19.172dae58.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/20.fc12cd35.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/21.dac60903.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/22.6ad8ce91.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/23.b9c307ef.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/25.9d0cca77.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/3.066c74ac.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/4.e8fd1e8e.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/5.5c367995.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/6.18dc24fc.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/7.ba2c8a9f.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/8.23a09dcd.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/9.6fc443e9.js">
    <link rel="stylesheet" href="/javascript-the-definitive-guide/assets/css/0.styles.0a1f62b9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/javascript-the-definitive-guide/" class="home-link router-link-active"><!----> <span class="site-name">javascript-the-definitive-guide</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="http://www.atguigu.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  官网
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="http://www.gulixueyuan.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  谷粒学院
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习路线" class="dropdown-title"><span class="title">学习路线</span> <span class="arrow down"></span></button> <button type="button" aria-label="学习路线" class="mobile-dropdown-title"><span class="title">学习路线</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://www.atguigu.com/web/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  前端
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://www.atguigu.com/kecheng.shtml" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Java
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://www.atguigu.com/bigdata/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  大数据
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="http://www.atguigu.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  官网
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="http://www.gulixueyuan.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  谷粒学院
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习路线" class="dropdown-title"><span class="title">学习路线</span> <span class="arrow down"></span></button> <button type="button" aria-label="学习路线" class="mobile-dropdown-title"><span class="title">学习路线</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://www.atguigu.com/web/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  前端
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://www.atguigu.com/kecheng.shtml" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Java
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://www.atguigu.com/bigdata/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  大数据
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>javascript-the-definitive-guide</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/javascript-the-definitive-guide/p01_Type.html" class="sidebar-link">词法结构（Lexical Structure）</a></li><li><a href="/javascript-the-definitive-guide/p02_Expression.html" class="sidebar-link">表达式和操作符（Expressions andOperators）</a></li><li><a href="/javascript-the-definitive-guide/p03_Statement.html" class="sidebar-link">语句 (Statements)</a></li><li><a href="/javascript-the-definitive-guide/p04_Object.html" class="sidebar-link">对象（Object）</a></li><li><a href="/javascript-the-definitive-guide/p05_Array.html" class="sidebar-link">数组（Arrays）</a></li><li><a href="/javascript-the-definitive-guide/p06_Function.html" class="sidebar-link">函数（Functions）</a></li><li><a href="/javascript-the-definitive-guide/p07_Class.html" class="sidebar-link">类（Classes）</a></li><li><a href="/javascript-the-definitive-guide/p08_Module.html" class="sidebar-link">模块（Modules）</a></li><li><a href="/javascript-the-definitive-guide/p09_Set.html" class="sidebar-link">JavaScript 标准库（The JavaScript Standard Library）</a></li><li><a href="/javascript-the-definitive-guide/p10_RegExp.html" class="sidebar-link">正则表达式（Pattern Matching with Regular Expressions）</a></li><li><a href="/javascript-the-definitive-guide/p11_StandardLib.html" class="sidebar-link">日期和时间（Dates and Times）</a></li><li><a href="/javascript-the-definitive-guide/p12_Iterator.html" class="sidebar-link">迭代器和生成器（Iterators and generators）</a></li><li><a href="/javascript-the-definitive-guide/p13_Promise.html" class="sidebar-link">异步 JavaScript（Asynchronous JavaScript）</a></li><li><a href="/javascript-the-definitive-guide/p14_Metaprogramming.html" class="sidebar-link">元编程（Metaprogramming）</a></li><li><a href="/javascript-the-definitive-guide/p15_WebBasic.html" class="sidebar-link">浏览器中的 JavaScript（JavaScript in Web Browsers）</a></li><li><a href="/javascript-the-definitive-guide/p16_Event.html" class="sidebar-link">事件（Events）</a></li><li><a href="/javascript-the-definitive-guide/p17_DocumentCSS.html" aria-current="page" class="active sidebar-link">Scripting Documents</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/javascript-the-definitive-guide/p18_Component.html" class="sidebar-link">Document 的滚动和几何学（Document Geometry and Scrolling）</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h3 id="scripting-documents"><a href="#scripting-documents" class="header-anchor">#</a> Scripting Documents</h3> <p>JavaScript 诞生的目的就是为了将静态的页面转换成</p> <p>每一个 Window 对象都拥有 document 属性，它指向了 Document 对象。Document 对象代表了网页中的内容。Document 对象并不会单独存在，而它是 DOM 的中心对象，用于表示和操纵 document 内容。</p> <p>DOM 已经在前面介绍过了，这一章会解释一下它包含的 API：</p> <ul><li>如何查询以及选择 document 中的元素</li> <li>如何遍历 document，并寻找指定元素的 ancestors/siblings/descendants 元素</li> <li>如何查询以及改变 document 元素属性</li> <li>如何查询以及改变 document 内容</li> <li>如何通过增删改节点来改变 document tree 结构</li></ul> <h4 id="选择-document-元素"><a href="#选择-document-元素" class="header-anchor">#</a> 选择 Document 元素</h4> <p>客户端 JavaScript 中全局的 document 属性指向了 Document 对象，其中的 head 和 body 属性又分别指向了 head 和 body 标签所对应的 Element 对象。</p> <h5 id="通过-css-选择器选择元素"><a href="#通过-css-选择器选择元素" class="header-anchor">#</a> 通过 CSS 选择器选择元素</h5> <p>CSS 拥有一个强大的句法，被称为选择器（selectors），可以用于描述单个或多个元素。DOM 中的方法 querySelector() 和 querySelectorAll() 可以使我们通过 CSS 选择器来查找元素。</p> <p>CSS 选择器可以通过标签，id（#），class（.）来描述元素：</p> <div class="language-scss extra-class"><pre class="language-scss"><code>div <span class="token comment">// 任何 div 标签的元素 </span>
#abc <span class="token comment">// 拥有 id='abc' 的元素 </span>
.abc <span class="token comment">// 拥有 class='abc' 的元素 </span>
</code></pre></div><p>或者可以通过更为指定的属性来选择：</p> <div class="language-scss extra-class"><pre class="language-scss"><code>p[lang=<span class="token string">'fr'</span>] <span class="token comment">// 任何法语编写的 p 标签（&lt;p lang=&quot;fr&quot;&gt;）</span>
*[name=<span class="token string">'abc'</span>] <span class="token comment">// 任何拥有 name='x' 的元素</span>
</code></pre></div><p>也可以是更为复杂的组合，或者指定了 document 中的位置：</p> <div class="language-scss extra-class"><pre class="language-scss"><code>span.fatal.error <span class="token comment">// 任何拥有 fatal 和 error 同时作为 class  的 span 标签的元素</span>
span[lang=<span class="token string">'fr'</span>].warning <span class="token comment">// 任何拥有 warning 作为 class，且是法语的 span 标签的元素</span>

h1<span class="token punctuation">,</span> h2 <span class="token comment">// 使用逗号分割代表符合其一即可</span>

#log span <span class="token comment">// id='log' 元素下所有 span 标签的 descendant（所有后裔）元素</span>
#log&gt;span <span class="token comment">// id='log' 元素下所有 span 标签的 child（仅子元素，孙元素不行） 元素</span>
body&gt;<span class="token property">h1</span><span class="token punctuation">:</span>first-child <span class="token comment">// body 中第一个 h1 的子元素</span>
img <span class="token operator">+</span> p.caption <span class="token comment">// 在 img 之后紧跟的 拥有 class='caption' 的 p</span>
h2 ~ p <span class="token comment">// 任何拥有 h2 作为 sibling（兄妹）的 p 元素</span>
</code></pre></div><p>querySelector() 方法就可以接收用字符串表示的 CSS 选择器作为 argument，在找到第一个匹配元素时，返回它，或者在找不到任何匹配时返回 null；querySelectorAll() 则会返回所有匹配值：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> h1 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;h1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 返回第一个 h1 </span>
<span class="token keyword">let</span> h2 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">&quot;h2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 返回所有 h2</span>
</code></pre></div><p>querySelectorAll() 的返回值不是包含 Element 对象的数组，而是一个类数组对象，被称为 NodeList。NodeList 对象也拥有 length 属性，也拥有和数组一样的索引，所以可以使用 for of 循环等遍历，我们可以通过 Array.from() 方法来将其转换成一个数组。</p> <p>这两个方法在 Element 类和 Document 类中都被实现了。对于 Document 使用，会在整个 Document 中查找，而对 Element 使用，则只会查找它的 descendants</p> <p>对于 CSS 中 ::first-line 等只截取 node 中的一部分的选择器无法在这两个方法中使用。许多浏览器页不允许 :link 和 :visited 选择器，因为可能会暴露用户隐私。</p> <p>另一种 CSS 选择器的方法时 closest()，它只在 Element 类中被定义。它也会接收一个 CSS 选择器作为 argument，如果有匹配元素，返回它；若没有匹配元素，它会返回最近的匹配的 ancestor（祖先)，若还是找不到，则返回 null。</p> <h5 id="其他的元素选择方法"><a href="#其他的元素选择方法" class="header-anchor">#</a> 其他的元素选择方法</h5> <p>除了通过 CSS 选择器来选择之外，还可以通过以下方法来选择：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> a1 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;a1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 通过 id 属性选择</span>
<span class="token keyword">let</span> a2 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByName</span><span class="token punctuation">(</span><span class="token string">&quot;a2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 通过 name 属性选择</span>
<span class="token keyword">let</span> a3 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByClassName</span><span class="token punctuation">(</span><span class="token string">&quot;a3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 通过 class 属性选择</span>
<span class="token keyword">let</span> h2 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">&quot;h2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 通过标签名选择</span>
</code></pre></div><p>getElementById() 会返回一个 Element 对象，而剩余的方法则和 querySelectorAll() 一样，返回一个 NodeList。</p> <h5 id="预设元素选择"><a href="#预设元素选择" class="header-anchor">#</a> 预设元素选择</h5> <p>出于历史原因，Document 类也定义了一些属性来直接访问特定的 nodes。比如 images，forms，links 属性会选择所有 img，form，a 标签的元素。这些属性指向了 HTMLCollection 对象，它和 NodeList 对象十分相似，不过 HTMLCollection 也可以通过 name 或者 id 查找：</p> <div class="language-js extra-class"><pre class="language-js"><code>document<span class="token punctuation">.</span>links<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 第一个超链接</span>
document<span class="token punctuation">.</span>links<span class="token punctuation">.</span>first <span class="token comment">// id 为 first 的超链接</span>
</code></pre></div><p>还有一个过时的 API：document.all，它可以用 HTMLCollection 来返回 document 中的所有元素。不过目前已被遗弃，不应该再被使用。</p> <h4 id="document-的结构和遍历"><a href="#document-的结构和遍历" class="header-anchor">#</a> Document 的结构和遍历</h4> <p>在选择了一个 Element 之后，我们可以调用其 traversal API 来遍历 document tree 中的 Element 对象，并且忽略 Text 节点:</p> <ul><li><strong>parentNode：</strong> Element 对象上的该属性指向了该元素的 parent 对象</li> <li><strong>children：</strong> 该属性为包含了 Element 对象上的是所有子元素的 NodeList</li> <li><strong>childElementCount：</strong> 该属性为子元素数量，等同于 children.length</li> <li><strong>firstElementChild：</strong> 该属性指向了第一个子元素</li> <li><strong>lastElementChild：</strong> 该属性指向了最后一个子元素</li> <li><strong>nextElementSibling：</strong> 该属性指向了下一个兄妹元素</li> <li><strong>previousElementSibling：</strong> 该属性指向了上一个兄妹元素</li></ul> <p>深度优先遍历 document：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 第一种</span>
<span class="token keyword">function</span> <span class="token function">dfs</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 可以在这做些什么</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> child <span class="token keyword">of</span> e<span class="token punctuation">.</span>childern<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">dfs</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 递归遍历</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 第二种</span>
<span class="token keyword">function</span> <span class="token function">dfs</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 可以在这做些什么</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">let</span> child <span class="token operator">=</span> element<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">;</span> <span class="token comment">// 使用链表风格</span>
  <span class="token keyword">while</span><span class="token punctuation">(</span>child <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">dfs</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 递归遍历</span>
    child <span class="token operator">=</span> child<span class="token punctuation">.</span>nextElementSibling<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>而如果我们不想忽略 Text 节点时，我们可以使用以下属性，所有的 Node 对象都拥有它们：</p> <ul><li><strong>parentNode：</strong> 该属性指向了该元素的 parent 节点对象</li> <li><strong>childNodes：</strong> 该属性为包含了该对象上的是所有子节点对象的 NodeList</li> <li><strong>firstChild：</strong> 该属性指向了第一个子节点</li> <li><strong>lastChild：</strong> 该属性指向了最后一个子节点</li> <li><strong>nextSibling：</strong> 该属性指向了下一个兄妹节点</li> <li><strong>nextSibling：</strong> 该属性指向了上一个兄妹节点</li> <li><strong>nodeType：</strong> 表示节点种类的数字，9 为 Document 节点，1 为 Element 节点，3 为 Text 节点，8 为 Comment 节点</li> <li><strong>nodeValue：</strong> Text 和 Comment 节点的文字内容</li> <li><strong>nodeName：</strong> HTML 标签名，转换成大写</li></ul> <h4 id="元素属性"><a href="#元素属性" class="header-anchor">#</a> 元素属性</h4> <p>HTML 的 element 都拥有一个标签名，以及一系列表示属性的 name/value pairs。我们可以使用 getAttribute(), setAttribute(), hasAttribute(), removeAttribute() 来取得，改变，测试，移除特定的属性。但其实 HTMLElement 对象上拥有对应的属性作为属性名，所以用起来会更方便。</p> <h5 id="以-element-对象属性表示-html-属性"><a href="#以-element-对象属性表示-html-属性" class="header-anchor">#</a> 以 ELement 对象属性表示 HTML 属性</h5> <p>Element 对象表示的 HTML 元素通常定义了用于读写的属性。所有的 Element 对象都定义了 id，title，lang，dir 以及事件处理函数。对于某些特定类型的 Element 还定义附加的属性，如 img 的 src 属性。</p> <p>HTML 的属性不用区分大小写，但是 JavaScript 属性需要，使用 camelCase（驼峰命名法）来命名。某些 HTML 属性名是 JavaScript 中的保留字，对于他们的解决方案通常是加上 html 前缀。比如 HTML 的 for 属性，进入 JavaScript 属性就成为了 htmlFor。class 也是一个保留字，但是它比较特殊，所以改名为了 className。</p> <p>虽然 Element 对象上的属性定义了读写方法，但没有定义移除的方法，所以再移除属性时调用 removeAttribute() 来实现。</p> <h5 id="class-属性"><a href="#class-属性" class="header-anchor">#</a> class 属性</h5> <p>对于 HTML 元素来说，class 属性十分重要，它的值时一列通过空格分割的 CSS 类。JavaScript 中使用 classsName 属性表示。我们可以直接更改 className，不过更多的时候，我们只需要修改其中一个类。</p> <p>处于这个原因，Element 对象也定义了 classList 属性，是我们可以将 HTML 的 class 属性当做一个 list 来处理。classList 的值是一个类数组对象，可以被迭代，也可以使用以下方法：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> a <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#a1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
a<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 删除指定类</span>
a<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 增加指定类</span>
a<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 是否包含指定类</span>
a<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">toggle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 若该类存在，删除它；若不存在，添加它</span>
</code></pre></div><h5 id="dataset-属性"><a href="#dataset-属性" class="header-anchor">#</a> dataset 属性</h5> <p>某些时候我们会需要为 HTML 元素添加更多的数据，然后让 JavaScript 来操纵或者选取它们。在 HTML 中，任何以 data- 前缀开头的属性都是合理的数据，它们并不会改变 HTML 元素展示的样子，而是一种标准的增加附加数据的方法。</p> <p>在 DOM 中，Element 对象拥有一个 dataset 属性，它指向了一个包含对应的 data- 属性作为属性的对象，不过不再拥有前缀。比如 dataset.x 就指向了 HTML 标签中的 data-x 属性。对应时还会从连字符转到 camelCase，即 data-my-age 会变成 dataset.myAge：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>age<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-my-age</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>22<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>age<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>对应</p> <div class="language-js extra-class"><pre class="language-js"><code>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>myAge<span class="token punctuation">;</span> <span class="token comment">// '22'</span>
</code></pre></div><h4 id="元素内容"><a href="#元素内容" class="header-anchor">#</a> 元素内容</h4> <p>假设 HTML 中有一个 p 元素：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>This is a <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span><span class="token punctuation">&gt;</span></span>simple<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span> example<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>那么它的内容是什么呢？</p> <ul><li>是 'This is a &lt;i&gt;simple&lt;/i&gt; document' 嘛？</li> <li>又或是 'This is a simple document' 呢？</li></ul> <p>其实它们都可以被称之为答案，并且拥有特定的用处</p> <h5 id="以-html-作为元素内容"><a href="#以-html-作为元素内容" class="header-anchor">#</a> 以 HTML 作为元素内容</h5> <p>读取 Element 的 innerHTML 属性时，返回的就会是 'This is a &lt;i&gt;simple&lt;/i&gt; document'，即包含了 HTML 标签的字符串。我们对其进行修改时，也可以加入 HTML 标签，而它们也会被正常的解析。</p> <p>因为浏览器十分擅长解析 HTML，所以通常改变 innerHTML 是比较高效的，但如果对 innerHTML 使用 += 操作符就不再高效了，因为需要格外的序列化步骤，将 HTML 元素转换成字符串，然后再将新的字符串解析回去。</p> <p>还有一点需要注意，不要让用户输入的数据进入 document，不然他可能再你的程序中恶意插入它的代码。</p> <p>outerHTML 和 innerHTML 很像，不过会包含元素本身：'&lt;p&gt;This is a &lt;i&gt;simple&lt;/i&gt; example&lt;/p&gt;'。一个相关的方法是 insertAdjacentHTML()，它使我们可以再 HTML 中为指定元素的相邻位置插入字符串标识的 markup。markup 会作为第二个 argument 表示，而第一个 argument 定义了 adjacent 的位置，可以是 'beforebegin', 'afterbegin', 'beforeend', 'afterend' 中的一个：</p> <p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0ea7bb9607554ad1b3f67f325fbbfd68~tplv-k3u1fbpfcp-watermark.image" alt=""></p> <h5 id="以纯文本作为元素内容"><a href="#以纯文本作为元素内容" class="header-anchor">#</a> 以纯文本作为元素内容</h5> <p>在我们只需要元素的内容的文字部分时，或者需要插入纯文本时（没有 markup 的标签等），我们可以使用 textContent 属性来实现，比如前面的例子就会返回 'This is a simple document'。</p> <p>textContent 属性是在 Node 类上定义的，所以其子类 Element node 和 Text node 都拥有该属性。</p> <h4 id="创建-插入-删除节点"><a href="#创建-插入-删除节点" class="header-anchor">#</a> 创建，插入，删除节点</h4> <p>除去查询和修改之外，我们也可以直接创建，插入或删除节点，然后直接改变 document 的结构。Document 类中顶一个用于创建 Element 对象的方法，Element 对象和 Text 对象又拥有了插入，删除，以及替换节点的方法。</p> <p>想要创建一个新的 Element 对象并修改它十分的简单：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> p <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建新的 p 元素</span>
<span class="token keyword">let</span> em <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'em'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建新的 em 元素</span>
em<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'world'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 为 em 从右增加字符串</span>
p<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>em<span class="token punctuation">,</span> <span class="token string">'!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将 em 加入 p 中</span>
p<span class="token punctuation">.</span><span class="token function">prepend</span><span class="token punctuation">(</span><span class="token string">'Hello '</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 为 p 从左增加字符串</span>
p<span class="token punctuation">.</span>innertHTML <span class="token comment">// &quot;Hello &lt;em&gt;World&lt;/em&gt;!&quot;</span>
</code></pre></div><p>append() 和 preend() 方法接收任意数量的 arguments，且可以是字符串或者 Node 对象，字符串会自动转换成 Text 节点。（或使用 document.createTextNode() 来显式创建，但是没必要）</p> <p>如果要在 Element 或者 Text 节点的中间插入，则需要先得到对于某个 sibling 节点的引用，然后调用 before() 或 after() 方法：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 找到拥有 class='greetings' 的 h2 元素</span>
<span class="token keyword">let</span> greetings <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;h2.greetings&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 在它后面添加 p 和一个 horizontal rule（hr）</span>
greetings<span class="token punctuation">.</span><span class="token function">after</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;hr&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>如果想要复制一个节点，可以使用 cloneNode() 方法，若传入 true 作为 argument，则会将其中所有内容复制；若传入 false 或不传 argument，则只会复制标签和属性。若想要移除一个节点，我们可以使用 document 的 remove() 方法，或者 replaceWith() 用于替换：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> p2 <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">cloneNode</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 复制 p</span>
greetings<span class="token punctuation">.</span><span class="token function">replaceWith</span><span class="token punctuation">(</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 删除 greetings，并用 p2 替代</span>
p2<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 删除 p2</span>
</code></pre></div><h3 id="scripting-css"><a href="#scripting-css" class="header-anchor">#</a> Scripting CSS</h3> <p>除了操纵 HTML document 的内容和结构之外，JavaScript 也可以操纵 CSS 来改变其展示风格。以下属性是最常在 JavaScript 中被用到的 CSS 风格：</p> <ul><li><strong>display 属性：</strong> 通过将其设置为 none 来隐藏元素</li> <li><strong>position 属性：</strong> 通过将其设置为 absolute，relative 或者 fixed，然后修改元素展示位置</li> <li><strong>transform 属性：</strong> 用于移动，旋转，拉伸元素</li> <li><strong>transition 属性：</strong> 为元素添加动画，这些动画会通过浏览器自动处理，而不需要额外的 JavaScript</li></ul> <h4 id="css-类"><a href="#css-类" class="header-anchor">#</a> CSS 类</h4> <p>最基础的操纵 CSS 的用法就是从 HTML 的 class 标签新增或删除 CSS 类名。使用 classList 属性来操作会很简单。比如我们可以定义一个 CSS 类：</p> <div class="language-scss extra-class"><pre class="language-scss"><code><span class="token selector">.hidden </span><span class="token punctuation">{</span> <span class="token comment">// 该类元素会被隐藏</span>
  <span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>然后通过 JavaScript 修改 class 名来隐藏/显示元素：</p> <div class="language-js extra-class"><pre class="language-js"><code>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#x&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;hidden&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 隐藏 id 为 x 的元素</span>
document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#x&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">&quot;hidden&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 展示它</span>
</code></pre></div><h4 id="inline-styles"><a href="#inline-styles" class="header-anchor">#</a> Inline Styles</h4> <p>我们可以通过 JavaScript 来修改 HTML 元素的 style 属性来改变它的风格。DOM 为每一个 Element 对象定义了一个 style 属性，指向了对应的 HTML style 属性。style 和大多属性不同，他不是一个字符串，而是一个 CSSStyleDeclaration 对象：一个被解析的，拥有以字符串表示的 CSS 风格的对象。比如我们可以这样定义一个修改元素位置的函数：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">displayAt</span><span class="token punctuation">(</span><span class="token parameter">element<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  element<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'block'</span><span class="token punctuation">;</span>
  element<span class="token punctuation">.</span>style<span class="token punctuation">.</span>position <span class="token operator">=</span> <span class="token string">'absolute'</span><span class="token punctuation">;</span>
  element<span class="token punctuation">.</span>style<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>x<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  element<span class="token punctuation">.</span>style<span class="token punctuation">.</span>top <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>y<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>CSSStyleDeclaration 的命名风格和 HTML 中的不同，因为连字符在 JavaScript 会被当成减号，所以会将 kebab-case 转换成 camelCase，比如 border-left-width 会变成 borderLeftWidth。</p> <p>在和 CSSStyleDeclaration 打交道时，要记住所有的属性值都是字符串：</p> <div class="language-scss extra-class"><pre class="language-scss"><code><span class="token selector">.e </span><span class="token punctuation">{</span> <span class="token comment">// CSS 中不用字符串来表示</span>
  <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>
  <span class="token property">font-family</span><span class="token punctuation">:</span> sans-serif<span class="token punctuation">;</span> 
  <span class="token property">background-color</span><span class="token punctuation">:</span> #ffffff<span class="token punctuation">;</span>
  <span class="token property">margin-left</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>对应：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// JavaScript 中则需要是字符串</span>
e<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">&quot;block&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 注意分号在字符串外，它们是 JavaScript 的分号</span>
e<span class="token punctuation">.</span>style<span class="token punctuation">.</span>fontFamily <span class="token operator">=</span> <span class="token string">&quot;sans-serif&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 我们不需要为 CSS 传入分号</span>
e<span class="token punctuation">.</span>style<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token string">&quot;#ffffff&quot;</span><span class="token punctuation">;</span>
e<span class="token punctuation">.</span>style<span class="token punctuation">.</span>marginLeft <span class="token operator">=</span> <span class="token string">&quot;300px&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 注意是字符串而非数字，也要注意单位</span>
</code></pre></div><p>我们也可以使用 getAttribute 和 setAttribute，或者 cssText 属性来查询 inline style，而且会简单一些：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 将 e 的 inline styles 复制到 f 上，下面两个方法都可以</span>
f<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;style&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;style&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
f<span class="token punctuation">.</span>style<span class="token punctuation">.</span>cssText <span class="token operator">=</span> e<span class="token punctuation">.</span>style<span class="token punctuation">.</span>cssText<span class="token punctuation">;</span>
</code></pre></div><p>在通过 style 属性查询元素的 CSS 时，我们只能得到其 inline style，而无法取得外部 CSS 的风格。</p> <h4 id="computed-styles"><a href="#computed-styles" class="header-anchor">#</a> Computed Styles</h4> <p>一个元素的 Computed Styles 就是其所有风格的属性和值的集合（包括 inline 的，浏览器定义的，CSS 定义的）：这也是展示元素时用到的属性。Computed Styles 也是通过 CSSStyleDeclaration 对象来代表的，不过和 inline style 不同，它是一个只读对象，我们不能修改它。</p> <p>我们可以通用 Window 对象上的 getComputedStyle() 方法来取得元素的风格，第一个 argument 是需要查询的元素，第二个可选的 argument 是用于指定 CSS 中的伪代码（类似 ::before 等）：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> title <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#section1title&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> styles <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">getComputedStyle</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> beforeStyles <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">getComputedStyle</span><span class="token punctuation">(</span>title<span class="token punctuation">,</span> <span class="token string">&quot;::before&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>getComputedStyle() 方法的返回值是一个 CSSStyleDeclaration，它代表了指定元素上所有的风格。虽然都是 CSSStyleDeclaration 对象，但是 inline style 表示的和 computed style 表示的还是有许多区别的：</p> <ul><li>computed style 的属性是只读的</li> <li>computed style 的属性是绝对的：所以百分比等非绝对值都会转换成绝对值，任何需要 size 的属性（如 font-size 和 margin size）都会转换成 pixels（px 后缀）；颜色则会被转换成 rgb() 或者 rgba() 形式</li> <li>computed style 不包含简写属性：比如 margin 不被包含，只会包含其中的 marginLeft，marginTop 等</li> <li>computed style 的 cssText 属性是 undefined</li></ul> <p>通常来说，getComputedStyle() 返回的 CSSStyleDeclaration 对象会拥有更多的信息。但是某些时候它包含的信息是很狡猾的，比如 top 和 left 的属性通常会返回 auto 作为值，虽然一点都不 make sense，不过这是一个合理的 CSS 值。</p> <p>虽然 CSS 可以用于精确的指定元素的 position 和 size，但是通过查询 computed style 并不是最完美的查询 position 和 size 的方法。等下会介绍更好的方法。</p> <h4 id="scripting-stylesheets"><a href="#scripting-stylesheets" class="header-anchor">#</a> Scripting Stylesheets</h4> <p>除去操纵 inline style 之外，JavaScript 也可以操纵 stylesheets（即以 sstyle 标签的元素，或 rel='stylesheet' 的 link）。因为它们都是 HTML 标签，所以可以通过 doncument.querySelector() 等方法查找。style 和 link 元素对应的 Element 对象拥有 disabled 属性，我们可以用它来 disable 整个 stylesheet：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">switchTheme</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 切换主题</span>
  <span class="token keyword">let</span> light <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#light-theme'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> dark <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#-theme'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>dark<span class="token punctuation">.</span>disabled<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    light<span class="token punctuation">.</span>disable <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    dark<span class="token punctuation">.</span>disable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> 
    light<span class="token punctuation">.</span>disable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    dark<span class="token punctuation">.</span>disable <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>或者我们可以为 DOM 添加 link 来加入 stylesheet：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> link <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'link'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建 link 对象</span>
link<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token string">&quot;style&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 设置 id</span>
link<span class="token punctuation">.</span>rel <span class="token operator">=</span> <span class="token string">&quot;stylesheet&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 设置 rel</span>
link<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">style.css</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span> <span class="token comment">// 设置 href</span>
document<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>link<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 加入 document 中</span>
</code></pre></div><h4 id="css-动画和事件"><a href="#css-动画和事件" class="header-anchor">#</a> CSS 动画和事件</h4> <p>假设这有两个 CSS 类：</p> <div class="language-scss extra-class"><pre class="language-scss"><code><span class="token selector">.transparent </span><span class="token punctuation">{</span> <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">.fade </span><span class="token punctuation">{</span> <span class="token property">transition</span><span class="token punctuation">:</span> opacity .5s ease-in <span class="token punctuation">}</span>
</code></pre></div><p>第一个会使元素完全透明化，而第二个为其增加了 fade 效果。假设我们已经有了一个拥有 fade 类的元素，我们在 JavaScript 中为其增加 transparent 类时，它会自动触发动画；在删除时也会触发。我们不需要在 JavaScript 中额外的定义什么，它们都是纯粹的 CSS 特效，JavaScript 仅仅使用来触发它们的。</p> <p>JavaScript 也可以被用来监听 CSS transition 的进度，因为浏览器会在 transition 开始和结束时触发事件。transitionrun 事件会在 transition 效果触发时触发，它会在视觉效果变化前触发（如果设有 trainsition-delay）；transitionstart 事件会在视觉效果开始时触发；transitionend 会在动画结束时触发。传入该类事件的处理函数的 argument 会是 TransitionEvent 对象，拥有额外的 propertyName 属性，指定了用于动画的 CSS 属性，以及 elapsedTime 属性指定了从 transitionstart 到 transitionend 花了多少时间。</p> <p>除去 transition，CSS 还支持 animation。它包含比如 animation-name 和 animation-duration 属性，和一个指定的 @keyframes rule 用于指定其细节。我们也可以通过 JavaScript 增删 CSS 类来触发它。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/javascript-the-definitive-guide/p16_Event.html" class="prev">
        事件（Events）
      </a></span> <span class="next"><a href="/javascript-the-definitive-guide/p18_Component.html">
        Document 的滚动和几何学（Document Geometry and Scrolling）
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/javascript-the-definitive-guide/assets/js/app.b70006d3.js" defer></script><script src="/javascript-the-definitive-guide/assets/js/2.c2bc8f28.js" defer></script><script src="/javascript-the-definitive-guide/assets/js/24.e6e4f156.js" defer></script>
  </body>
</html>
