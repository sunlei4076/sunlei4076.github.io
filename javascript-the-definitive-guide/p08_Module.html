<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>模块（Modules） | javascript-the-definitive-guide</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="shortcut icon" type="image/x-icon" href="/javascript-the-definitive-guide/favicon.ico">
    <meta name="description" content="javascript-the-definitive-guide">
    
    <link rel="preload" href="/javascript-the-definitive-guide/assets/css/0.styles.bb7bf066.css" as="style"><link rel="preload" href="/javascript-the-definitive-guide/assets/js/app.4c89be95.js" as="script"><link rel="preload" href="/javascript-the-definitive-guide/assets/js/2.c2bc8f28.js" as="script"><link rel="preload" href="/javascript-the-definitive-guide/assets/js/15.45820836.js" as="script"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/10.b94191f9.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/11.38677894.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/12.fcded803.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/13.6e5f6082.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/14.0fc28e1c.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/16.3124fb08.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/17.dce0f8e0.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/18.65c4cbd2.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/19.8cc98c22.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/20.fc12cd35.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/21.5ce63821.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/22.dc71fcb6.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/3.327a4fa9.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/4.d55aa230.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/5.5c367995.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/6.18dc24fc.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/7.04483a08.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/8.1483022f.js"><link rel="prefetch" href="/javascript-the-definitive-guide/assets/js/9.b57d10fe.js">
    <link rel="stylesheet" href="/javascript-the-definitive-guide/assets/css/0.styles.bb7bf066.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/javascript-the-definitive-guide/" class="home-link router-link-active"><!----> <span class="site-name">javascript-the-definitive-guide</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="http://www.atguigu.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  官网
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="http://www.gulixueyuan.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  谷粒学院
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习路线" class="dropdown-title"><span class="title">学习路线</span> <span class="arrow down"></span></button> <button type="button" aria-label="学习路线" class="mobile-dropdown-title"><span class="title">学习路线</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://www.atguigu.com/web/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  前端
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://www.atguigu.com/kecheng.shtml" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Java
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://www.atguigu.com/bigdata/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  大数据
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="http://www.atguigu.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  官网
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="http://www.gulixueyuan.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  谷粒学院
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习路线" class="dropdown-title"><span class="title">学习路线</span> <span class="arrow down"></span></button> <button type="button" aria-label="学习路线" class="mobile-dropdown-title"><span class="title">学习路线</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://www.atguigu.com/web/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  前端
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://www.atguigu.com/kecheng.shtml" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Java
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://www.atguigu.com/bigdata/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  大数据
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>javascript-the-definitive-guide</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/javascript-the-definitive-guide/p01_Type.html" class="sidebar-link">词法结构（Lexical Structure）</a></li><li><a href="/javascript-the-definitive-guide/p02_Expression.html" class="sidebar-link">表达式和操作符（Expressions andOperators）</a></li><li><a href="/javascript-the-definitive-guide/p03_Statement.html" class="sidebar-link">语句 (Statements)</a></li><li><a href="/javascript-the-definitive-guide/p04_Object.html" class="sidebar-link">对象（Object）</a></li><li><a href="/javascript-the-definitive-guide/p05_Array.html" class="sidebar-link">数组（Arrays）</a></li><li><a href="/javascript-the-definitive-guide/p06_Function.html" class="sidebar-link">函数（Functions）</a></li><li><a href="/javascript-the-definitive-guide/p07_Class.html" class="sidebar-link">类（Classes）</a></li><li><a href="/javascript-the-definitive-guide/p08_Module.html" aria-current="page" class="active sidebar-link">模块（Modules）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/javascript-the-definitive-guide/p08_Module.html#模块-modules" class="sidebar-link">模块（Modules）</a></li></ul></li><li><a href="/javascript-the-definitive-guide/p09_Set.html" class="sidebar-link">JavaScript 标准库（The JavaScript Standard Library）</a></li><li><a href="/javascript-the-definitive-guide/p10_RegExp.html" class="sidebar-link">正则表达式（Pattern Matching with Regular Expressions）</a></li><li><a href="/javascript-the-definitive-guide/p11_StandardLib.html" class="sidebar-link">日期和时间（Dates and Times）</a></li><li><a href="/javascript-the-definitive-guide/p12_Iterator.html" class="sidebar-link">迭代器和生成器（Iterators and generators）</a></li><li><a href="/javascript-the-definitive-guide/p13_Promise.html" class="sidebar-link">异步 JavaScript（Asynchronous JavaScript）</a></li><li><a href="/javascript-the-definitive-guide/p14_Metaprogramming.html" class="sidebar-link">元编程（Metaprogramming）</a></li><li><a href="/javascript-the-definitive-guide/p15_WebBasic.html" class="sidebar-link">浏览器中的 JavaScript（JavaScript in Web Browsers）</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="模块-modules"><a href="#模块-modules" class="header-anchor">#</a> 模块（Modules）</h2> <p>模块化编程的目的就是为了使庞大的项目可以被一个个不同的组件所组成。其中的组件既可以是我们自己编写的，也可以是别的作者开源的代码。模块化的主要目的是为了封装私有的实现细节，只暴露必要的接口，一这种方法使全局命名空间尽可能地整洁。</p> <p>其实直到近几年之前，JavaScript 一直没有对于模块的内嵌支持，所以对于大型的项目只能使用类，对象，闭包等方法进行一些弱模块化的处理。基于闭包的模块化处理被 Node 采纳，所以产生了 require() 函数用作类模块化的处理，但 Node 环境并为被官方 JavaScript 所采纳。</p> <p>不过在 ES6 中，模块通过了 import 和 export 关键字被定义。这章介绍了：</p> <ul><li>Node require() 实现的模块</li> <li>ES6 通过 exprort 和 import 实现的模块</li></ul> <h3 id="node-中的模块-modules-in-node"><a href="#node-中的模块-modules-in-node" class="header-anchor">#</a> Node 中的模块（Modules in Node）</h3> <p>在 Node 中编程时，会将代码分到许多个文件中。其原因是这些文件在 fast filesystem 上运行，而非网速很慢的浏览器。</p> <p>在 Node 中，每一个文件都是一个独立的模块，拥有其私用的命名空间。在不进行 export 和 require 的情况下，文件之间的变量是不会共通的。（Node 13 以后也支持了 ES6 模块，但是大多还是在使用 Node 模块）</p> <h4 id="node-中的-exports"><a href="#node-中的-exports" class="header-anchor">#</a> Node 中的 Exports</h4> <p>Node 定义了一个名为 exports 的全局变量，如果想要 exports 多个值，只需要把它们都定义为 exports 对象上的属性即可：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function">sum</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span> <span class="token operator">=</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>
exports<span class="token punctuation">.</span><span class="token function-variable function">mean</span> <span class="token operator">=</span> <span class="token parameter">data</span> <span class="token operator">=&gt;</span> data<span class="token punctuation">.</span><span class="token function">redue</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token operator">/</span>data<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token comment">// 将想要导出的值作为 exports 对象的属性</span>
</code></pre></div><p>但是更多数的情况，一个模块只需要 exports 一个函数或者类，而非一个装满属性的对象。我们可以用 modele.exports 实现：</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token class-name">A2</span> <span class="token keyword">extends</span> <span class="token class-name">A1</span> <span class="token punctuation">{</span> <span class="token comment">// 直接导出 A2 这个类</span>
  <span class="token comment">// class 的内容</span>
<span class="token punctuation">}</span>
</code></pre></div><p>module.exports 的默认值和 exports 指向了同一个对象，所以第一个 exports 的例子中，我们也可以使用 module.exports.mean 代替 exports.mean，或者：</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span> mean <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 直接 exports 一个对象，将函数添加在中间，对于需要 exports 多个函数就会方便一点</span>
</code></pre></div><h4 id="node-中的-imports"><a href="#node-中的-imports" class="header-anchor">#</a> Node 中的 Imports</h4> <p>Node 中的 imports 使用另一个称为 require() 的函数实现的。这个函数的 argument 就是我们希望 import 的模块名，返回值就是 export 的值。（多数为函数、类或对象)</p> <p>import 内嵌模块或者在 package manager 中下载的模块时，只需要传入它们的名字即可：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 内嵌 filesystem 模块</span>
<span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;http&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 内嵌 HTTP 模块</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 下载好的第三方模块 express</span>
</code></pre></div><p>import 自己定义的模块时，模块名要改成其在 file 中的位置。我们可以使用绝对位置（/），不多通常情况会使用相对位置（./ 或 ../）：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> stats <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./stats.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 其实 js 后缀名也可以被省略  </span>
<span class="token keyword">let</span> avg1 <span class="token operator">=</span> stats<span class="token punctuation">.</span><span class="token function">mean</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 在调用 stats 中的方法是要加上前缀</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> mean <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./stats.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 可以用解构赋值，只导入我们想要的方法</span>
<span class="token keyword">let</span> avg1 <span class="token operator">=</span> <span class="token function">mean</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// mean 被加入 local 命名空间后则不用加前缀</span>
</code></pre></div><h3 id="es6-中的模块-modules-in-es6"><a href="#es6-中的模块-modules-in-es6" class="header-anchor">#</a> ES6 中的模块（Modules in ES6）</h3> <p>ES6 新增了 import 和 export 关键字用于支持模块化，他和 Node 模块的理念是相同的：每一个文件都是一个新模块，任何其中的变量，函数，对象都不会出现在别的文件中，除非进行 export 和 import。它们的不同只不过是他们的句法。任何在 ES6 模块中定义的语句都会自动进入严格模式，所以在编写 ES6 模块时，我们不会需要显式的写 &quot;use strict&quot;。其实 ES6 模块会进入一个跟样恶的模式，在其中 top-level 中的 this 也会指向 undefined（而非全局对象）。</p> <h4 id="es6-中的-exports"><a href="#es6-中的-exports" class="header-anchor">#</a> ES6 中的 Exports</h4> <p>我们使用关键字 export 来导出需要的函数、类、常量等：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">PI</span> <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">;</span> <span class="token comment">// export 常量</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">degToRad</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> d <span class="token operator">*</span> <span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">100</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// export 函数</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Circle</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span> r <span class="token operator">=</span> r<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">area</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token constant">PI</span> <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>r<span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token comment">// export 类</span>
</code></pre></div><p>除了上面这种一个一个 export 的方法之外，我们也可以先将他们声明，在最后一起 export：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token punctuation">{</span> Circle<span class="token punctuation">,</span> degToRad<span class="token punctuation">,</span> <span class="token constant">PI</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 一起 export，虽然句法看上去接近对象字面量，但并不是</span>
</code></pre></div><p>在只要 export 一个值时（通常时函数或者类），我们会使用 export default 代替 export：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">{</span>
  <span class="token comment">// code</span>
<span class="token punctuation">}</span>
</code></pre></div><p>使用 default export 会更容易 import，所以在只有一个值时，尽量使用 export default。</p> <p>需要注意的是，我们只能在 top-level 中 export，而不能在类，函数，条件或循环等中进行 export。这使得静态统计更为便捷，因为每一个模块在每一次运行时都会 export 同样的值。</p> <h4 id="es6-中的-imports"><a href="#es6-中的-imports" class="header-anchor">#</a> ES6 中的 Imports</h4> <p>import 关键字使我们可以导入被 export 的值，其句法如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token constant">A</span> <span class="token keyword">from</span> <span class="token string">'./A.js'</span><span class="token punctuation">;</span> <span class="token comment">// A 的值就是 default export 的值</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> mean <span class="token punctuation">}</span>  <span class="token keyword">from</span>  <span class="token string">&quot;./stats.js&quot;</span><span class="token punctuation">;</span> <span class="token comment">// mean 的值就是前面 export 的函数，类似于解构赋值</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> stats <span class="token keyword">from</span> <span class="token string">&quot;./stats.js&quot;</span><span class="token punctuation">;</span> <span class="token comment">// import stats文件中所有被 export 的值</span>
<span class="token keyword">import</span> <span class="token string">&quot;./test.js&quot;</span><span class="token punctuation">;</span> <span class="token comment">// import 一个没有 export 值的文件，它会且只会在第一次被 import 时运行一次</span>
</code></pre></div><p>被 import 赋值会成为一个常量，就像是被 const 赋值一般，所以无法被更改。同 export 一样，import 也只能出现在 top level。虽然把 import 放在模块的顶部已成为了一个世界通用的规范，但这并不是必需的，import 也会被提升（hoisted）到顶部。</p> <p>import 会从一个字符串字面量获得值（上面的 './A.js'）。我们不能使用别的值或变量，也不能使用反引号。在浏览器中，这个字面量会指向用来 import 的 URL；在 Node 或者其他打包工具时，则是文件的路径（即使是在同一文件夹下，也需要使用 ./ 来代表路径，而不能直接输入其文件名）。</p> <h4 id="对-imports-and-exports-进行改名"><a href="#对-imports-and-exports-进行改名" class="header-anchor">#</a> 对 Imports and Exports 进行改名</h4> <p>如果两个模块 export 了两个拥有同一个名称的不同值，我们需要对他们其中至少一个进行改名。同样的，对于 import 也是如此。我们可以使用 as 关键字：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> render <span class="token keyword">as</span> renderImg <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./a.js'</span><span class="token punctuation">;</span> <span class="token comment">// render 同名了，改成 renderImg</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> render <span class="token keyword">as</span> renderText <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./b.js'</span><span class="token punctuation">;</span> <span class="token comment">// 同上</span>
</code></pre></div><p>对于 export 进行改名也是可行的，但是并不常见。因为在遇到这种情况时，还不如直接将需要 export 的值进行更有意义的命名。对于 export 也是使用 as 关键字：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token punctuation">{</span>
  render <span class="token keyword">as</span> renderImg<span class="token punctuation">,</span> <span class="token comment">// 将 render 改名成 renderImg</span>
  display <span class="token keyword">as</span> displayImg，
  Math<span class="token punctuation">.</span>sin <span class="token keyword">as</span> sin <span class="token comment">// SyntaxError，as 左边不能是表达式，必须是单一的 identifier</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="re-exports"><a href="#re-exports" class="header-anchor">#</a> Re-Exports</h4> <p>假如在某一个模块中 export 了两个函数，但是大多是情况下我们只需要其中一个时，我们可以将它们定义到单独的文件中。这样的话，在只 import 一个函数的情况下，我们的 import 方法会变得更为简洁。</p> <p>但如果我们在将他们放入单独的文件后又需要同时 improt 它们的话该怎么做呢？我们可以把他们 import 进同一个文件之后在进行 export：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> a <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./a.js'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> b <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./b.js'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> a<span class="token punctuation">,</span> b <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>其实在 ES6 中还有更为简单的句法被称为 re-export，使用方法是 export from 句法：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token punctuation">{</span> a <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./a.js'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> b <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./b.js'</span><span class="token punctuation">;</span>
</code></pre></div><p>使用 re-export 时也可以用 as 进行改名。</p> <h4 id="网络上的-javascript-模块"><a href="#网络上的-javascript-模块" class="header-anchor">#</a> 网络上的 JavaScript 模块</h4> <p>在 2020 年初时，许多 ES6 编写的 production code 依然需要用如 webpack 之类的打包工具进行打包。这么做虽然也有弊端（在某些时候，使用多个小模块代替大的打包文件可以更好的利用缓存），不过整体来说，打包过的代码会具有更好的性能。不过随着未来网速的增加，以及浏览器对 ES6 更好的支持，这一点可能会改变。</p> <p>虽然目前打包工具在 production 时很重要，但是在 development 的环境下时是不需要的，因为现在所有的浏览器都拥有对 module 的支持。因为模块的执行发方式和非模块代码相差巨大，他其实也改变了 HTML。如果想要对浏览器直接进行 import，我们会需要用到改动过的 &lt;script type='module'&gt; 标签。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"><span class="token keyword">import</span> <span class="token string">&quot;./main.js&quot;</span><span class="token punctuation">;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>使用这种标签其实等同于拥有 defer 特性的 script 标签。这意味着它会在 HTML 语道 script 标签时直接开始解析式（但是代码的执行需要在解析完毕之后），在解析完成后，会以出现在 HTML 中的顺序进行执行。</p> <p>module 的 script 还有和普通 script 的不同便是其同源特性。在普通的 script 中，我们可以加载任何网络服务器上的 JavaScript 文件，但是 module 的 script 只允许进行同源的加载，或者拥有正确的 CORS 请求头来进行跨域加载。</p> <h3 id="使用-import-进行动态加载"><a href="#使用-import-进行动态加载" class="header-anchor">#</a> 使用 import() 进行动态加载</h3> <p>我们前面所见的 import 和 export 都是完全静态的，所以 JavaScript 编译器可以在不运行代码的情况下直接进行加载。使用静态加载可以保证 import 进模块的值会在该模块运行前就被准备好。</p> <p>在网络上，代码则是通过网络而非 filesystem 进行传输的，而且传输后，代码经常会在 CPU 相对较弱的手机上执行。这时的静态 import 就不适用（因为需要将全部程序加载完才能运行）。</p> <p>所以在很多时候，web app 只需要先加载可以渲染出第一页的代码即可。这样，用户可以直接进行交互，然后再加载出剩余的代码。浏览器对于动态加载的方法很简单，只需要动态的使用 DOM API 传入一个新的 script 标签即可。</p> <p>虽然动态加载已经存在了很久了，不过并没有成为 JavaScript 的一部分。直到 ES2020，动态加载 import() 加入了。我们只需要传入一个模块作为 argument，它会返回一个 Promise 对象是我们可以进行异步的加载。在 Promise 完成时，他会产出一个等同于静态 import 加载的对象：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> stats <span class="token keyword">from</span> <span class="token string">'./stats.js'</span><span class="token punctuation">;</span> <span class="token comment">// 静态加载</span>
<span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./states.js'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">stats</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// 动态加载</span>
  <span class="token keyword">let</span> avg <span class="token operator">=</span> states<span class="token punctuation">.</span><span class="token function">mean</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">async</span> <span class="token function">analyzeData</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 使用 async 和 await 进行封装</span>
  <span class="token keyword">let</span> stats <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./stats.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    avg <span class="token operator">:</span> stats<span class="token punctuation">.</span><span class="token function">mean</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在使用 import() 时，其 argument 不再一定是一个字符串字面量了，也可以是一个产出字符串的表达式。虽然 import() 的形式很像函数调用，但其其实是一个操作符。其原因是在加载 URL 时会进行一些无法在函数中运行的语句。除了浏览器之外，其实类似 webpack 之类的打包工具也可以使用动态 import()</p> <h4 id="import-meta-url"><a href="#import-meta-url" class="header-anchor">#</a> import.meta.url</h4> <p>在 ES6 模块中，import.meta 指向了包含当前运行模块的元数据（metadata）的对象。这个对象的 url 属性就是模块加载的 url。（在 Node 没有 import.meta.url 但可以使用 file://URL)</p> <p>import.meta.url 的主要用法就是去指向该模块中储存的图片或文件。使用 URL() 使用绝对 import.meta.url之类的绝对 url 会方便。</p> <h3 id="小结"><a href="#小结" class="header-anchor">#</a> 小结：</h3> <p>这一章的要点：</p> <ul><li>模块的目的时隐藏实现时的许多细节，而只暴露尽可能少的接口</li> <li>在 JavaScript 早期，模块化只能通过调用函数表达式实现</li> <li>Node 增加了其对模块的支持，使用 require() 和 module.exports 和 Exports 对象进行 import 和 export</li> <li>在 ES6 中，JavaScript 获得了其对模块化支持的关键字 import 和 export</li> <li>在 ES2020 中，新加入了动态 import()</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/javascript-the-definitive-guide/p07_Class.html" class="prev">
        类（Classes）
      </a></span> <span class="next"><a href="/javascript-the-definitive-guide/p09_Set.html">
        JavaScript 标准库（The JavaScript Standard Library）
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/javascript-the-definitive-guide/assets/js/app.4c89be95.js" defer></script><script src="/javascript-the-definitive-guide/assets/js/2.c2bc8f28.js" defer></script><script src="/javascript-the-definitive-guide/assets/js/15.45820836.js" defer></script>
  </body>
</html>
